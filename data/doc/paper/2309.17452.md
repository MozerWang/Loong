# ToRA: A ToOL-INTEGRATED REASONING AGENT 

FOR MATHEMATICAL PROBLEM SOLVING

Zhibin Gou ${ }^{1,2 *}$, Zhihong Shao ${ }^{1,2 *}$, Yeyun Gong ${ }^{2 \dagger}$, Yelong Shen ${ }^{3}$<br>Yujiu Yang ${ }^{1 \dagger}$, Minlie Huang ${ }^{1 \dagger}$, Nan Duan ${ }^{2}$, Weizhu Chen ${ }^{3}$<br>${ }^{1}$ Tsinghua University ${ }^{2}$ Microsoft Research ${ }^{3}$ Microsoft Azure AI<br>\{gzb22,szh19\}@mails.tsinghua.edu.cn<br>\{yegong, yeshe, nanduan,wzchen\}@microsoft.com


#### Abstract

Large language models have made significant progress in various language tasks, yet they still struggle with complex mathematics. In this paper, we propose ToRA,

![](https://cdn.mathpix.com/cropped/2024_06_04_e8cffa1ed7f7407502a8g-01.jpg?height=40&width=1135&top_left_y=1010&top_left_x=495) ematical problems by seamlessly integrating natural language reasoning with the utilization of external tools (e.g., computation libraries and symbolic solvers), thereby amalgamating the analytical prowess of language and the computational efficiency of tools. To train ToRA, we curate interactive tool-use trajectories on mathematical datasets, apply imitation learning on the annotations, and propose output space shaping to further refine models' reasoning behavior. As a result, ToRA models significantly outperform open-source models on 10 mathematical reasoning datasets across all scales with $13 \%-19 \%$ absolute improvements on average. Notably, ToRA-7B reaches $44.6 \%$ on the competition-level dataset MATH, surpassing the best open-source model WizardMath-70B by $22 \%$ absolute. ToRACODE-34B is also the first open-source model that achieves an accuracy exceeding $50 \%$ on MATH, which significantly outperforms GPT-4's CoT result, and is competitive with GPT-4 solving problems with programs. Additionally, we conduct a comprehensive analysis of the benefits and remaining challenges of tool interaction for mathematical reasoning, providing valuable insights for future research ${ }^{1}$


![](https://cdn.mathpix.com/cropped/2024_06_04_e8cffa1ed7f7407502a8g-01.jpg?height=494&width=1347&top_left_y=1691&top_left_x=389)

Figure 1: Comparing ToRA with baselines on LLaMA-2 base models from 7B to 70B. ToRA models exhibit remarkable improvements over previous state-of-the-art approaches across all scales. In particular, ToRA-70B notably outperforms GPT-4's CoT result on MATH and attains comparable results to GPT-4 solving problems with code.[^0]

![](https://cdn.mathpix.com/cropped/2024_06_04_e8cffa1ed7f7407502a8g-02.jpg?height=686&width=769&top_left_y=280&top_left_x=388)

(a) Rationale-based (b) Program-based

![](https://cdn.mathpix.com/cropped/2024_06_04_e8cffa1ed7f7407502a8g-02.jpg?height=738&width=580&top_left_y=276&top_left_x=1157)

Figure 2: Examples of three reasoning formats for mathematical reasoning: (a) Rationale-based methods (e.g., CoT prompting) generate step-by-step natural language rationales, (b) Program-based methods (e.g., PAL prompting) solve tasks with program synthesis, and (c) our proposed Toolintegrated Reasoning format interleaves rationales with program-based tool use. For brevity, we present a simple example of single-round tool interaction, where the model creates rationale $r_{1}$ for analysis, writes program $a_{1}$ to call an external solver, obtains the execution output $o_{1}$, and then generates rationale $r_{2}$ to finalize the answer.

## 1 INTRODUCTION

Large language models (LLMs), such as GPT-4 (OpenAI, 2023) and PaLM-2 (Anil et al. 2023), have demonstrated remarkable progress in a wide range of language tasks, particularly in the longstanding challenge of mathematical reasoning (Feigenbaum et al., 1963; Hosseini et al., 2014). However, open-source models, such as LLaMA-2 (Touvron et al., 2023a|b) and Falcon (Penedo et al., 2023), still struggle with advanced mathematical reasoning tasks.

Existing works improve mathematical performance of language models either with step-by-step natural language reasoning (Wei et al. 2022) as illustrated in Fig 2 (a), or by synthesizing and executing programs to obtain the answers (Gao et al. 2022; Chen et al., 2022), as depicted in Fig 2 (b). Both approaches exhibit complementary advantages. Natural language is suitable for semantic analysis, planning, and abstract reasoning (e.g., commonsense reasoning), but struggles with precise computation, symbolic manipulation, and algorithmic processing. Conversely, programs excel in rigorous operations, and can outsource intricate calculations to specialized tools like equation solvers.

To leverage the benefits of both natural language reasoning and program-based tool use, we train open-source models such as LLaMA-2 to reason in a way where natural language reasoning is interleaved with program-based tool use synergistically (as depicted in Fig 2 (c)), thereby largely reducing the gap with closed-source models like GPT-4 in mathematical reasoning. Specifically, we first design the interleaving format of reasoning, curate corresponding interactive tool-use trajectories for mathematical problems from the popular GSM8k (Cobbe et al., 2021) and MATH (Hendrycks et al. 2021) dataset, and then apply imitation learning on the high-quality annotations, leading to a better performance than any existing open-source model. Furthermore, since the curated data is far from exhausting all valid trajectories for a problem, relying solely on imitation learning restricts a model's output space, hindering the flexibility in exploring plausible trajectories during testing. To improve the diversity of plausible reasoning steps and mitigate improper tool-use behavior, we apply output space shaping which additionally trains the models on both self-sampled valid trajectories and invalid ones that have been corrected by a teacher model (e.g., a 34B model can serve as the teacher

(1) Imitation Learning
![](https://cdn.mathpix.com/cropped/2024_06_04_e8cffa1ed7f7407502a8g-03.jpg?height=510&width=1378&top_left_y=324&top_left_x=379)

Figure 3: Training ToRA contains two steps. (1) Imitation Learning: Prompt LLMs like GPT-4 to generate Tool-integrated Reasoning trajectories (TORA-CORPUS) and use this corpus to fine-tune a model $\mathcal{M}$; (2) Output Space Shaping: Sample diverse tool-use trajectories with $\mathcal{M}$, keep the valid ones, correct the invalid ones with a teacher model $\mathcal{M}^{\prime}$, and retrain $\mathcal{M}$ on the union of sampled valid trajectories, corrected ones, and the initial ToRA-CorpUS to obtain ToRA.

for a 7B model). Output space shaping significantly boosts reasoning, allowing open-source models to attain an accuracy exceeding $50 \%$ on the competition-level MATH dataset for the first time.

We evaluate the resulting suite of Tool-integrated Reasoning Agents (ToRA) ranging from 7B to 70B on 10 diverse mathematical reasoning datasets. As shown in Fig 1. ToRA series significantly outperform open-source models across all scales. Notably, on the competition-level MATH dataset, ToRA-7B outperforms the previous SoTA WizardMath-70B (Luo et al., 2023) by $22 \%$ absolute. ToRA-CODE-34B beats GPT-4's CoT result (Bubeck et al., 2023) by $8.3 \%$ absolute $(50.8 \%$ vs. $42.5 \%$ ), and is competitive with GPT-4 solving problems with code (GPT-4-Code, 51.8\%). In addition, we analyze the benefits and remaining challenges of tool interaction for mathematical reasoning, providing valuable insights for future work.

## 2 ToRA: Tool-InTEGRated AGENTS FOR MATHEMATICAL ReASONING

### 2.1 OVERVIEW

ToRA series solve challenging mathematical problems by leveraging both natural language reasoning and program-based tool use. As shown in Fig 2 (c), given a mathematical problem $q$, ToRA reasons with natural language, producing $r_{1}$. When reaching a point where program-based tool use is more appropriate for the subsequent task, e.g., equation solving, ToRA generates a program $a_{1}$ for tool use following natural language guidance $r_{1}$. The execution output $o_{1}$ will be fed to ToRA for subsequent processing including tool use adjustments, sub-tasks solving, or answer finalization. We repeat the process until the model places its answer within " $\backslash$ boxed \{\} ". The resulting trajectory is denoted as $\tau=r_{1} a_{1} o_{1} \ldots r_{n-1} a_{n-1} o_{n-1} r_{n}$, where $r_{n}$ contains the answer.

Fig 3 presents the training pipeline of ToRA. We first collect interactive tool-use trajectories on popular mathematical datasets. We then apply imitation learning on the resulting annotations, as well as output space shaping to further refine models' reasoning behavior.

### 2.2 Collecting INTERACTIVE TOOL-Use TRaJECTORIES

Existing mathematical reasoning datasets primarily contain annotations in either natural language or code, posing a challenge for training tool-integrated agents due to the absence of interactive tool-use annotations. To address this, we utilize GPT-4 to synthesize high-quality trajectories on the GSM8k and MATH training sets. We select GSM8k and MATH as they exhibit diverse reasoning patterns, spanning multiple domains and difficulty levels.

```
Algorithm 1 Inference of Tool-Integrated Reasoning
Require: problem $q$, model $\mathcal{G}$, prompt $p$, external tools $\mathcal{E}$, stop condition $\operatorname{Stop}(\cdot)$, maximum iteration rounds $n$
    $\tau_{0} \leftarrow " " \quad \triangleright$ Trajectory Initialization
    for $i \leftarrow 1$ to $n$ do
        $r_{i} \sim \mathbb{P}_{\mathcal{G}}\left(\cdot \mid p \oplus q \oplus \tau_{i-1}\right)$
            $\triangleright$ Rationale Generation (Eq. 1 .
        if $\operatorname{Stop}\left(r_{i}\right)$ then
            return $\tau_{i-1} \oplus r_{i}$
        end if
        $a_{i} \sim \mathbb{P}_{\mathcal{G}}\left(\cdot \mid p \oplus q \oplus \tau_{i-1} \oplus r_{i}\right) \quad \triangleright$ Program Generation (Eq. 2 2
        $o_{i} \leftarrow \mathcal{E}\left(a_{i}\right) \quad \triangleright$ Tool Execution
        $\tau_{i} \leftarrow \tau_{i-1} \oplus r_{i} \oplus a_{i} \oplus o_{i} \quad \triangleright$ Trajectory Update (Eq. 3)
    end for
    return $\tau_{n}$
```

Prompt Curation We compose instructions along with diverse few-shot examples, utilizing an interleaved format as depicted in Fig 2 (c). These examples showcase interactive tool usage trajectories, incorporating descriptive variable names and combined program outputs. Please refer to Appendix E for the assembled prompts.

Inference Procedure We follow Algorithm 1 and feed GPT-4 (G) with the composed prompt $p$ to generate a tool-use trajectory $\tau$ for each question $q$ from the training set. The trajectory is initialized as an empty string $\tau_{0}$, for each interaction round $i$, we first generate a rationale:

$$
\begin{equation*}
r_{i} \sim \mathbb{P}_{\mathcal{G}}\left(\cdot \mid p \oplus q \oplus \tau_{i-1}\right) \tag{1}
\end{equation*}
$$

where $\oplus$ means concatenation. If $r_{i}$ includes an answer within " $\backslash$ boxed \{\} " (i.e., the stopping condition Stop $\left(r_{i}\right)$ ), we cease generation, otherwise the model continues to write a program for tool use:

$$
\begin{equation*}
a_{i} \sim \mathbb{P}_{\mathcal{G}}\left(\cdot \mid p \oplus q \oplus \tau_{i-1} \oplus r_{i}\right) \tag{2}
\end{equation*}
$$

In line with Gou et al. (2023), if the model triggers the code execution stop words like " ` ` output", we supply it with the corresponding execution message and output $o_{i}$ by calling tools with $o_{i} \leftarrow \mathcal{E}\left(a_{i}\right)$, facilitating the generation of subsequent steps. Then, we update the trajectory by concatenating it with the newly generated rationale $r_{i}$, program $a_{i}$, and output $o_{i}$ :

$$
\begin{equation*}
\tau_{i} \leftarrow \tau_{i-1} \oplus r_{i} \oplus a_{i} \oplus o_{i} \tag{3}
\end{equation*}
$$

We repeat the above interaction process until we reach the maximum rounds $n$.

Trajectory Sampling We set $n=3$ and perform inference using GPT-4 with greedy decoding, retaining trajectories that yield correct answers. For questions where GPT-4 fails with greedy decoding, we apply nucleus sampling with a sample size of 10 and keep up to 4 valid trajectories per question. Ultimately, we successfully annotate trajectories for $98.2 \%$ of GSM8k questions and $83.1 \%$ of MATH questions. After filtering out invalid trajectories with tool-use errors or wrong answers, we obtain 16k annotations which constitute our dataset ToRA-Corpus. Table 1 compares ToRACORPUS with recently proposed mathematical reasoning datasets, while Table 6 in the Appendix displays MATH annotation accuracy details.

### 2.3 TRAINING

Imitation Learning We apply imitation learning on ToRA-Corpus by minimizing negative log-likelihood loss on the trajectory $\tau$ conditioned on the problem $q$ :

$$
\begin{equation*}
\mathcal{M}=\arg \min _{\mathcal{M}} \sum_{q, \tau} \sum_{i=1}^{n-1}-\log \mathbb{P}_{\mathcal{M}}\left(r_{i+1} a_{i+1} \mid q, r_{1} \ldots o_{i}\right) \tag{4}
\end{equation*}
$$

where $\mathcal{M}$ is the resulting model. After imitation learning, we can simply apply the same procedure in Algorithm 1 by setting prompt to empty $p=" "$ for inference. Imitation learning leads to state-of-theart mathematical reasoning performance despite the small scale of TORA-CORPUS.

Table 1: Compared with mathematical reasoning datasets, ToRA-CorpuS uniquely combines natural language rationales with program-based tool usage. Note that ToRA-CORPUS only employ questions from the original training set of MATH and GSM8k.

| Methods | \#Annotation | Tool | Interleaving | LLM Used | Source |
| :--- | :---: | :---: | :---: | :---: | :---: |
| RFT Yuan et al.. 2023 | $>100 \mathrm{k}$ | $x$ | $x$ | LLaMA-2 | GSM8k |
| Open-Platypus Lee et al. 2023, | $25 \mathrm{k}$ | $x$ | $x$ | GPT-4 | 11 datasets with MATH |
| WizardMath Luo et al., 2023, | $>96 \mathrm{k}$ | $x$ | $x$ | ChatGPT | MATH \& GSM8k |
| Lila Mishra et al., 2022, 2023, | $134 \mathrm{k}$ | $\checkmark$ (PoT) | $x$ | - | 20 datasets with MATH \& GSM8k |
| MathInstruct Yue et al., 2023 | $260 \mathrm{k}$ | $\checkmark$ (PoT) | $x$ | GPT-4 | 14 datasets with MATH \& GSM8k |
| ToRA-CorPus (ours) | $16 \mathrm{k}$ | $\checkmark$ | $\checkmark$ | GPT-4 | MATH \& GSM8k |

Output Space Shaping For each question, ToRA-CorPUS mostly demonstrates only one valid interactive tool-use trajectory, which may restrict a model's output space, rendering it inflexible in exploring plausible trajectories during testing. We therefore propose output space shaping in order to encourage the diversity of plausible reasoning steps and reduce improper tool-use behavior.

To explore diverse valid trajectories, we apply nucleus sampling to imitation learning models $\mathcal{M}$ to sample 64 trajectories per training question $q$, following the inference procedure in Section 2.2. We retain valid trajectories with correct answers and no tool-use errors. As many samples are duplicates, to further improve diversity and in an attempt to correct models' improper behavior, we seek to leverage invalid trajectories as well. We observe that trajectories with wrong answers are mostly incorrect halfway (Li et al. 2023), and the preceding reasoning is still plausible; in other words, we can obtain valid trajectories by correcting the subsequent portions. Specifically, a wrong trajectory $\widetilde{\tau}$, when written in text, can be represented as a sequence of lines separated by line breaks, i.e., $\widetilde{\tau}=l_{1} \ldots l_{m}$, where $m$ is the total number of lines in $\widetilde{\tau}$. We enumerate possible preceding portions of wrong trajectories, i.e., $\widetilde{\tau}[: j]=l_{1} \ldots l_{j}$, and leverage a teacher model $\mathcal{M}^{\prime}$ to complete the subsequent steps with greedy decoding: $\tau \leftarrow \mathbb{P}_{\mathcal{M}^{\prime}}(\cdot \mid q \oplus \widetilde{\tau}[j])$ where we abuse the notation $\mathbb{P}_{\mathcal{M}^{\prime}}(\cdot)$ to denote the interactive tool use process following Section 2.2. Finally, corrected trajectories as well as valid trajectory samples will be used for model training, thereby shaping the output space.

In our experiments, we always use CodeLLaMA-34B trained on ToRA-CORPUS as the teacher model, and apply sampling with the CodeLLaMA series (ranging from 7B to 34B, with imitation learning). We obtain a total of $233 \mathrm{k}$ distinct valid trajectory samples and $69 \mathrm{k}$ corrected ones. From this combined dataset, we randomly select up to 4 trajectories per GSM8k and MATH problem, merge them with ToRA-CORPUS, and then train all ToRA models on the resulting $69 \mathrm{k}$ annotations.

## 3 EXPERIMENTS

### 3.1 IMPLEMENTATION DETAILS

We fine-tuned LLaMA-2 (Touvron et al., 2023b) and CodeLLaMA (Rozière et al., 2023) series (ranging from 7B to 70B) using ToRA-CorPUS with output space shaping, yielding the TORA and ToRA-CODE series respectively. We used a learning rate of $2 \mathrm{e}-5$ by default except that we used 1e-5 for the 34B and 70B models. We set the global batch size to 128 and used a linear scheduler with a $3 \%$ warm-up period for 3 epochs. We trained all models with DeepSpeed ZeRO Stage3 (Rajbhandari et al. 2021) and Flash-Attention 2 (Dao, 2023). We used greedy decoding for all results, with the maximum sequence length set to 2,048 and the maximum number of tool executions set to 3 .

### 3.2 EVALUATION SETUP

Datasets We evaluated models on GSM8k (Cobbe et al. 2021) and MATH (Hendrycks et al., 2021), along with 8 out-of-distribution datasets, namely GSM-Hard (Gao et al., 2022), SVAMP (Patel et al. 2021), ASDIV (Miao et al., 2020), TabMWP (Lu et al. 2023), SingleEQ, SingleOP, AddSub, and MultiArith (Koncel-Kedziorski et al. 2016), as illustrated in Table 5 in Appendix. The 10 assorted datasets collectively encompass mathematical problems spanning basic arithmetic to competition level, covering middle and high school curricula and various mathematical domains. The problem formats comprise tabular-based, free-form, and multiple-choice questions, ensuring a thorough assessment of the model's mathematical reasoning aptitude.

Table 2: Results on 10 mathematical reasoning tasks. MAWPS results are averaged over four tasks: Singleeq, Singleop, Addsub, and MultArith. Vanilla models are tested with CoT. The best results in each section are in blue, the second-best results are underlined, while the results of our best model are bolded. * ZS: Zero-shot inference without demonstrations.

| Model | Size | Tools | $\mathbf{Z S}^{*}$ | GSM8k | MATH | GSM-Hard | SVAMP | TabMWP | ASDiv | MAWPS | AVG |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| Used for training? |  |  |  | $\checkmark$ | $\checkmark$ | $x$ | $x$ | $x$ | $x$ | $x$ |  |
| Proprietary Models |  |  |  |  |  |  |  |  |  |  |  |
| GPT-4 | - | $x$ | $x$ | 92.0 | 42.5 | 64.7 | 93.1 | 67.1 | 91.3 | 97.6 | 78.3 |
| GPT-4 (PAL) | - | $\checkmark$ | $x$ | 94.2 | 51.8 | 77.6 | 94.8 | 95.9 | 92.6 | 97.7 | 86.4 |
| ChatGPT | - | $x$ | $x$ | 80.8 | 35.5 | 55.9 | 83.0 | 69.1 | 87.3 | 94.6 | 72.3 |
| ChatGPT (PAL) | - | $\checkmark$ | $x$ | 78.6 | 38.7 | 67.6 | 77.8  | $79.9 \quad$ | 81.0 | 89.4 | 73.3 |
| Claude-2 | - | $x$ | $x$ | 85.2 | 32.5 | - | - | - | - | - | - |
| PaLM-2 | 540B | $x$ | $x$ | 80.7 | 34.3 | - | - | - | - | - | - |
| Open-Source Models |  |  |  |  |  |  |  |  |  |  |  |
| LLaMA-2 | 7B | $x$ | $x$ | 13.3 | 4.1 | 7.8  | 38.0 | 31.1 | 50.7 | 60.9 | 29.4 |
| LLaMA-2 SFT | 7B | $x$ | $\checkmark$ | 41.3 | 7.2 | 16.1 | 31.9 | 27.8 | 47.4 | 60.0 | 33.1 |
| LLaMA-2 RFT | 7B | $x$ | $\checkmark$ | 51.2 | - | - | - | - | - | ![](https://cdn.mathpix.com/cropped/2024_06_04_e8cffa1ed7f7407502a8g-06.jpg?height=34&width=113&top_left_y=890&top_left_x=1509) | ![](https://cdn.mathpix.com/cropped/2024_06_04_e8cffa1ed7f7407502a8g-06.jpg?height=34&width=113&top_left_y=890&top_left_x=1621) |
| Platypus-2 | 7B | $x$ | $x$ | 14.4 | 5.4 | 8.6 | 36.7 | 26.5 | 47.9 | 58.4 | 28.3 |
| WizardMath | $7 \mathrm{~B}$ | $x$ | $\checkmark$ | 54.9 | 10.7 | 20.6 | 57.3 | 38.1 | 59.1 | 73.7 | $44.9 \quad$ |
| CodeLLaMA (PAL) | $7 \mathrm{~B}$ | $\checkmark$ | $x$ | 34.0 | 16.6 | 33.6 | 59.0 | 47.3 | 61.4 | 79.6 | 47.4 |
| Toolformer ${ }^{\dagger}$ - | 7B | $\checkmark$ | $\checkmark$ | - | - | - | 29.4 | - -1 1 | 40.4 | 44.0 | - |
| ToRA | 7B | $\checkmark$ | $\checkmark$ | $\underline{68.8}$ | $\underline{40.1}$ | $\underline{54.6}$ | $\underline{68.2}$ | 42.4 | $\underline{73.9}$ | $\underline{88.8}$ | $\underline{62.4}$ |
| TORA-CODE | 7B | $\checkmark$ | $\checkmark$ | $\overline{72.6}$ | $\overline{44.6}$ | $\overline{56.0}$ | $\overline{70.4}$ | 51.6 | $\overline{78.7}$ | $\overline{91.3}$ | $66 . \overline{5(+19)}$ |
| LLaMA-2 | $13 \mathrm{~B}$ | $x$ | $x$ | 24.3 | $\overline{6.3}$ | $\overline{13.6}$ | 43.1 | 39.5 | $\overline{56.3}$ | $\overline{70.4}$ | 36.2 |
| LLaMA-2 SFT | 13B | $x$ | $\checkmark$ | 51.1 | 9.2 | 22.3 | 46.3 | 35.8 | 58.6 | 75.0 | 42.6 |
| LLaMA-2 RFT | $13 \mathrm{~B}$ | $x$ | $\checkmark$ | 55.3 | - | - | - | - | - | - | - |
| Platypus-2 | $13 \mathrm{~B}$ | $x$ | $x$ | 23.7 | 7.1 | 14.3 | 50.7 | 45.3 | 55.1 | 69.6 | 38.0 |
| WizardMath | $13 \mathrm{~B}$ | $x$ | $\ddot{v}$ | 63.9 | 14.0 | 28.4 | $64.3 \quad$ | 46.7 | 65.8 | 79.7 | 51.8  |
| CodeLLaMA (PAL) | $13 \mathrm{~B}$ | $\ddot{v}$ | $x$ | 39.9 | 19.9 | 39.0 | 62.4 | $59.5 \quad$ | 65.3 | 86.0 | 53.1  |
| ToRA | 13B | $\checkmark$ | $\checkmark$ | 72.7 | 43.0 | $\underline{57.3}$ | $\underline{72.9}$ | $\overline{47.2}$ | 77.2 | $\underline{91.3}$ | 65.9 |
| TORA-CODE | 13B | $\checkmark$ | $\checkmark$ | $\overline{75.8}$ | $\overline{48.1}$ | $\overline{60.5}$ | $\overline{75.7}$ | 65.4 | $\overline{81.4}$ | $\overline{92.5}$ | $71.3(+18)$ |
| LLaMA-1 RFT | $34 \mathrm{~B}$ | $x$ | $\checkmark$ | 57.9 | - | - | - | - | - | - | - |
| CodeLLaMA (PAL) | $34 \mathrm{~B}$ | $\checkmark$ | $x$ | 53.3 | 23.9 | 49.4 | 71.0  | 63.1 | 72.4 | 91.5 | 60.7 |
| ToRA-CODE | $34 \mathrm{~B}$ | $\checkmark$ | $\checkmark$ | 80.7 | 50.8 | 63.7 | 80.5 | 70.5 | 84.2 | 93.3 | $74.8(+14)$ |
| LLaMA-2 | $70 \mathrm{~B}$ | $x$ | $x$ | $57.8 \quad$ | 14.4 | 36.0 | 73.6 | 57.5 | 76.0 | $92.4 \quad$ | 58.2 |
| LLaMA-2 SFT | $70 \mathrm{~B}$ | $x$ | $\checkmark$ | 69.3 | 14.9 | 39.0 | 64.0 | 53.0 | 71.3 | 84.8 | 56.6 |
| LLaMA-2 RFT | $70 \mathrm{~B}$ | $x$ | $\checkmark$ | 64.8 | ![](https://cdn.mathpix.com/cropped/2024_06_04_e8cffa1ed7f7407502a8g-06.jpg?height=34&width=102&top_left_y=1518&top_left_x=942) | - | - | - | - | - | - |
| Platypus-2 | $70 \mathrm{~B}$ | $x$ | $x$ | 45.9 | 15.0 | 24.6 | $74.3 \quad$ | 47.3 | 72.7 | 91.1 | 53.0 |
| WizardMath | $70 \mathrm{~B}$ | $x$ | $\checkmark$ | 81.6 | 22.7 | 50.3 | 80.0 | $49.8 \quad$ | 76.2 | 86.2 | 63.8 |
| LLaMA-2 (PAL) | $70 \mathrm{~B}$ | $\checkmark$ | $x$ | 55.2 | 18.3 | 50 | $\overline{74.6}$ | 59.5 | $\overline{71.9}$ | $92.8 \quad$ | 60.3 |
| ToRA | $70 \mathrm{~B}$ | $\checkmark$ | $\checkmark$ | 84.3 | 49.7 | 67.2 | 82.7 | $\overline{74.0}$ | 86.8 | $\overline{93.8}$ | $76.9(+13)$ |

Metrics We report accuracies of predicted answers. Following Lightman et al. (2023), we round numerical values and use sympy ${ }^{2}$ for parsing expressions. Since the SingleEQ, SingleOP, AddSub, and MultiArith datasets focus on different aspects of basic arithmetic, we report their average results under the collective term MAWPS (Koncel-Kedziorski et al., 2016) for all methods.

### 3.3 BASELINES

Proprietary Models We present results from an array of SoTA LLMs, such as OpenAI's GPT-4, ChatGPT (gpt-3.5-turbo), Google's PaLM-2, and Anthropic's Claude-2. By default, we report CoT prompting results, and include PAL (Gao et al. 2022) prompting results for selected models.

Open-Source Models Base models comprise LLaMA-2 and CodeLLaMA with CoT and PAL prompting. Supervised Fine-Tuning (SFT) employs CoT rationales from the original GSM8k and MATH dataset (15k samples) for fine-tuning. Rejection sampling Fine-Tuning (RFT) leverages multiple models to generate diverse reasoning paths for fine-tuning (Yuan et al., 2023). WizardMath augments data using ChatGPT, and conducts SFT and RLHF. Platypus-2, the top model on the LLM Leaderboard 3 , is fine-tuned with Open-Platypus reasoning datasets (Lee et al. 2023). We also compare ToRA with Toolformer (Schick et al. 2023) which is a model trained to utilize calculators.[^1]

Table 3: Results on MATH subtopics.

| Model | Size | Tool | Intermediate <br> Algebra | Precalculus | Geometry | Number <br> Theory |  <br> Probability | Prealgebra | Algebra | Overall |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| Proprietary Models |  |  |  |  |  |  |  |  |  |  |
| ChatGPT (PAL) ? | - | $\checkmark$ | 18.5 | 19.2 | 23.2 | 48.5 | 43.0 | 62.7 | 45.4 | 38.7 |
| GPT-4 (PAL) ? | - | $\checkmark$ | 32.8 | 29.3 | 38.0 | 58.7 | 61.0 | 73.9 | 59.1 | 51.8 |
| Open-Source Models |  |  |  |  |  |  |  |  |  |  |
| WizardMath | 7B | $x$ | 6.2 | 6.0 | 6.5 | 7.6 | 9.5 | 18.1 | 16.3 | 11.2 |
| TORA-CODE | 7B | $\checkmark$ | $35.1(+28.9)$ | $31.0(+25.0)$ | $24.0(+17.5)$ | $50.7(+43.1)$ | $30.6(+21.1)$ | $55.0(+36.9)$ | $61.7(+45.4)$ | $44.6(+33.4)$ |
| w/o Shaping | 7B | $\checkmark$ | $29.7(-5.4)$ | $25.1(-5.9)$ | $17.7(-6.3)$ | $46.9(-3.8)$ | $32.3(+1.7)$ | $51.9(-3.1)$ | $55.7(-6.0)$ | $40.2(-4.4)$ |
| w/o Rationale | 7B | $\checkmark$ | $25.5(-9.6)$ | $14.7(-16.3)$ | $15.4(-8.6)$ | $45.9(-4.8)$ | $29.7(-0.9)$ | $51.0(-4.0)$ | $52.4(-9.3)$ | $36.8(-7.8)$ |
| WizardMath | $13 \mathrm{~B}$ | $x$ | 6.4 | 6.6 | 11.5 | 9.6 | 11.0 | 28.5 | 21.1 | 15.0 |
| TORA-CODE | 13B | $\checkmark$ | $35.7(+29.3)$ | $31.1(+24.5)$ | $25.7(+14.2)$ | $55.6(+46.0)$ | $39.5(+28.5)$ | $58.7(+30.2)$ | $66.7(+45.6)$ | $48.1(+33.1)$ |
| w/o Shaping | 13B | $\checkmark$ | $32.8(-2.9)$ | $26.0(-5.1)$ | $24.0(-1.7)$ | $52.6(-3.0)$ | 38.4 (-1.1) | $55.6(-3.1)$ | $61.2(-5.5)$ | $44.6(-3.5)$ |
| w/o Rationale | 13B | $\checkmark$ | $27.1(-8.6)$ | $15.8(-15.3)$ | $16.3(-9.4)$ | $50.4(-5.2)$ | $36.9(-2.6)$ | $55.3(-3.4)$ | $56.5(-10.2)$ | $40.2(-7.9)$ |
| ToRA-CODE | $34 \mathrm{~B}$ | $\checkmark$ | 38.9 | 34.6 | 27.3 | 57.8 | 41.4 | 63.7 | 67.7 | 50.8 |
| w/o Shaping | $34 \mathrm{~B}$ | $\checkmark$ | $34.0(-4.9)$ | $29.9(-4.7)$ | $24.6(-2.7)$ | $55.6(-2.2)$ | $41.6(+0.2)$ | $63.8(+0.1)$ | $61.4(-6.3)$ | 47.4 (-3.4) |
| w/o Rationale | $34 \mathrm{~B}$ | $\checkmark$ | $28.3(-10.6)$ | $15.8(-18.8)$ | $18.0(-9.3)$ | $52.4(-5.4)$ | $40.7(-0.7)$ | $58.6(-5.1)$ | $57.5(-10.2)$ | $41.9(-8.9)$ |
| WizardMath | $70 \mathrm{~B}$ | $x$ | 9.1 | 13.4 | 16.9 | 16.5 | 19.2 | 42.7 | 35.0 | 24.1 |
| TORA | 70B | $\checkmark$ | $37.1(+28)$ | $30.4(+17)$ | $30.1(+13.2)$ | $54.6(+38.1)$ | $40.3(+21.1)$ | $64.9(+22.2)$ | $66.6(+31.6)$ | $49.7(+25.6)$ |
| w/o Shaping | $70 \mathrm{~B}$ | $\checkmark$ | $33.8(-3.3)$ | $28.9(-1.5)$ | $27.1(-3)$ | $53.0(-1.6)$ | $38.0(-2.3)$ | $62.2(-2.7)$ | $64.2(-2.4)$ | $47.3(-2.4)$ |
| w/o Rationale | 70B | $\checkmark$ | $26.7(-10.4)$ | $14.7(-15.7)$ | $20.3(-9.8)$ | $48.9(-5.7)$ | $39.2(-1.1)$ | $59.8(-5.1)$ | $57.6(-9)$ | $41.5(-8.2)$ |

### 3.4 MAIN RESULTS

Table 2 presents the results of ToRA on 10 mathematical datasets, highlighting the following salient observations: (1) Using interleaved formatting and output space shaping, ToRA consistently surpasses prior state-of-the-art open-source models across all scales, achieving $13 \%$ to $19 \%$ absolute improvements across 10 tasks. (2) ToRA-70B substantially outperforms ChatGPT with both CoT and PAL prompting on GSM8k ( $84.3 \%$ vs. $80.4 \%$ ) and MATH ( $49.7 \%$ vs. $38.7 \%$ ), while ToRACODE-34B is competitive with GPT-4 solving competition-level MATH dataset with code ( $50.8 \%$ vs. 51.8\%). (3) The accuracy of ToRA-CODE is about 5\% higher than ToRA of the same size, demonstrating that continued training on code data significantly benefits program-based tool use. (4) While rationale-based fine-tuning negatively affects out-of-distribution generalization, ToRA displays superior generalization. For instance, WizardMath-70B underperforms the base model on TabMWP ( $49.8 \%$ vs. $57.5 \%$ ), while ToRA-70B effectively generalizes to this tabular reasoning task (74.0\%). (5) ToRA attains fast zero-shot inference speed, averaging 1.02 tool interaction rounds per problem, while effectively addressing problems that require interactive tool utilization.

### 3.5 ABlation StUdY

![](https://cdn.mathpix.com/cropped/2024_06_04_e8cffa1ed7f7407502a8g-07.jpg?height=450&width=1387&top_left_y=1824&top_left_x=369)

Figure 4: Comparison of three formats: (1) Rationale-only: step-by-step natural language reasoning like CoT; (2) Program-only: solving problems with programs like PAL; (3) Tool-integrated Reasoning used by ToRA: interweaving rationale and program execution to solve problems. We evaluated GPT-4 with few-shot prompting. We trained LLaMA-2 models to reason in the three types of formats, respectively. For a fair comparison, we do not apply output space shaping for all LLaMA-2 models.

### 3.5.1 COMPARISONS OF FORMATTING

To evaluate the efficacy of the reasoning format adopted by ToRA which interleaves rationales with programs, we compared it with Rationale-only and Program-only formats using GPT-4 and LLaMA-2 trained with the same size of data from MATH. As shown in Fig 4, the ToRA method consistently surpasses Rationale-only and Program-only approaches. Remarkably, using LLaMA-2, the ToRA method achieves substantial improvements of $29.0 \%$ and $6.7 \%$ over Rationale-only and Program-only, respectively. With the closed-source GPT-4, the improvements are $19.1 \%$ and $9.8 \%$, respectively. This emphasizes the effectiveness of integrating natural language rationales with programs.

### 3.5.2 EfFects of OUtput Space Shaping

![](https://cdn.mathpix.com/cropped/2024_06_04_e8cffa1ed7f7407502a8g-08.jpg?height=355&width=1377&top_left_y=752&top_left_x=366)

Figure 5: Ablation on output space shaping strategies using CodeLLaMA: (1) ToRA-Correction is trained on ToRA-CorpUS without shaping. (2) ToRA-Correction employs only the sampling strategy for shaping, trained with up to 4 additional valid trajectory samples per problem. (3) ToRA utilizes both the sampling and correction, also trained with up to 4 additional trajectories per problem.

We assess the effectiveness of the output space shaping strategies presented in Section 2.3, specifically sampling and correction. As shown in Fig [5 and Table 3. (1) Output space shaping yields a considerable average improvement of $3.4 \%$ and $4.0 \%$ absolute for GSM8k and MATH, respectively, with greater benefits for smaller models; (2) Applying the sampling strategy results in a $2.7 \%$ absolute improvement on average, while additionally incorporating correction offers a more substantial boost of up to $4.5 \%$, without using more training data; (3) Output space shaping benefits even the largest model ToRA-70B, with a notable improvement from $47.3 \%$ to $49.7 \%$ on MATH. These findings highlight the effectiveness of our shaping strategies across different model sizes and datasets.

### 3.6 ANALYSIS

We investigate the benefits, detailed patterns, and remaining challenges of tool interaction for mathematical reasoning on the challenging MATH dataset. Performance breakdowns on all subtopics of MATH are reported in Table 3

Benefits from Tool-Integration for MATH Sub-topics As shown in Table 3. ToRA outperforms WizardMath by around $45 \%$ in Algebra and Number Theory, which is attributed to stimulating and shaping tool-use behavior. Problems from the two sub-topics typically need intricate computation and data manipulation. Algebra mainly focuses on solving equations and application problems, while many Number Theory problems can be tackled using brute-force approaches through code.

Patterns of Library Usage for Problem Solving Fig 6 presents the most frequently used libraries for different sub-topics and the corresponding accuracies of their solutions. Tool-use behavior on different mathematical areas demonstrates distinct patterns. sympy and its internal solvers are primarily employed for algebra-related topics. Precalculus exhibits extensive matrix operations via matrices, resulting in a high accuracy. Number Theory depends on algorithms like gcd and $1 \mathrm{~cm}$. Geometry mainly uses the rational library for fraction-based computations, while the application of other tools is limited, signifying the potential for improvement.

Detailed Impact of Rationale on Different Topics Table 3 shows that using an interleaved format, in contrast to merely writing the program, leads to significant improvements across all subtopics, especially in Precalculus, Algebra, and Geometry, where notable increases range from $8.6 \%$ to $18.8 \%$.
![](https://cdn.mathpix.com/cropped/2024_06_04_e8cffa1ed7f7407502a8g-09.jpg?height=442&width=1390&top_left_y=278&top_left_x=366)

Figure 6: Library usage frequency and accuracy on each sub-topic of MATH.

Appendix F. 1 provides representative examples demonstrating how the rationale aids in planning, multi-round self-correction, and finalizing answers.

Table 4: The failure modes of the ToRA on MATH, and their corresponding percentages in random samples analyzed by humans. We include specific examples of each failure mode in Appendix $F$.

| Error Type | Definition | $\frac{\%}{\%}$ | $\overline{\text { Examples }} \quad$ ser |
| :---: | :---: | :---: | :---: |
| Reasoning Error | Mistakes due to incorrect reasoning steps or missing conditions. | $38 \%$ |  |
| Hallucination | Fabrication of numbers or answers. | $5 \%$ |  |
| Diagram Understanding | Misinterpretation of the input diagram. | $21 \%$ | Ex. 7 |
| Inappropriate Tool Use | Incorrect use of external tools, especially when <br> the problem can't be solved directly with libraries. | $10 \%$ |  |
| Syr | Persistent syntax errors despite multiple correction attempts. | $9 \%$ | $F_{x}$ ज |
| Runtime Error | Errors during program execution, unresolved by retrying. | $9 \%$ | Ex. 10 |
| Rationale-only Error | Cannot be formalized into a program and the rationale is incorrect. | $3 \%$ | Ex. 11 |
| False Negative | Correct answers that don't fully match the ground truth. | $5 \%$ | Ex. 12 |

Remaining Challenges in Mathematical Reasoning for ToRA To better understand the failure modes and remaining challenges, we manually annotated 100 randomly selected trajectories from the MATH test set, identifying and categorizing their failure modes. The results are shown in Table 4: Primarily, incorrect reasoning steps constitute the primary source of errors for ToRA on complex math reasoning tasks ( $38 \%$ ), with some hallucination issues also evident during problem interpretation and answer finalization (5\%). Secondly, the misinterpretation of input diagrams contributes significantly to the error rate ( $21 \%$ ). This is particularly noticeable in Geometry, Precalculus, and Intermediate Algebra. The diagrams in the MATH dataset are usually detailed in text using the Asymptote language (Hendrycks et al. 2021), thus making it challenging for ToRA to comprehend diagrams purely from textual descriptions. Thirdly, issues with tool usage include Inappropriate Tool Usage (10\%), Syntax Error (9\%), and Runtime Error (9\%). These problems frequently arise when ToRA fails to use tools correctly after several corrections or attempts. There are certain inputs that fail to formalize well as programs ( $3 \%$ ), which require abstract reasoning rather than computation. Finally, we also found that there are false negatives when using automatic indicators, i.e., correct predictions that are misjudged as wrong, but the proportion is relatively small ( $5 \%$ ).

## 4 CONCLUSION

This paper presents ToRA, a series of novel Tool-integrated Reasoning Agents that synergistically combines natural language rationale with program-based tool-use for mathematical problem solving. Our approach demonstrates the potential of integrating external tools in the reasoning process, enabling language models to effectively tackle complex quantitative tasks. ToRA achieves stateof-the-art performance on 10 diverse mathematical reasoning tasks, substantially outperforming existing rationale-based and program-based approaches. Furthermore, our systematic analysis of the benefits and remaining challenges of tool interaction provides valuable insights for future research, contributing to the development of more advanced and versatile reasoning agents.

## AUTHOR CONTRIBUTIONS

Zhibin Gou proposed the interleaved tool-use format of ToRA and curated ToRA-Corpus dataset, implemented the training and evaluation pipeline, conducted experiments and analysis on all datasets, implemented baselines, and was a main contributor to the paper writing. Zhihong Shao proposed the project, conducted preliminary experiments, proposed and implemented the training and evaluation pipelines, proposed and trained all ToRA models with output space shaping as well as ToRA variants in the ablation study, designed and oversaw experimental analysis, and contributed to many parts of the paper writing. Yeyun Gong, Yelong Shen, Yujiu Yang, Minlie Huang, Nan Duan, and Weizhu Chen provided research mentorship, oversaw project coordination, and advised and contributed to many parts of the writing.

## ACKNOWLEDGMENTS

Zhibin Gou and Yujiu Yang were supported by the National Natural Science Foundation of China (Grant No. U1903213) and the Shenzhen Science and Technology Program (JSGG20220831110203007). Zhihong Shao and Minlie Huang were supported by the NSFC projects (Key project with No. 61936010 ), and were also supported by the National Science Foundation for Distinguished Young Scholars (with No. 62125604).

## REFERENCES

Rohan Anil, Andrew M Dai, Orhan Firat, Melvin Johnson, Dmitry Lepikhin, Alexandre Passos, Siamak Shakeri, Emanuel Taropa, Paige Bailey, Zhifeng Chen, et al. Palm 2 technical report. arXiv preprint arXiv:2305.10403, 2023.

Sebastian Borgeaud, Arthur Mensch, Jordan Hoffmann, Trevor Cai, Eliza Rutherford, Katie Millican, George Bm Van Den Driessche, Jean-Baptiste Lespiau, Bogdan Damoc, Aidan Clark, et al. Improving language models by retrieving from trillions of tokens. In International conference on machine learning, pp. 2206-2240. PMLR, 2022.

Sébastien Bubeck, Varun Chandrasekaran, Ronen Eldan, Johannes Gehrke, Eric Horvitz, Ece Kamar, Peter Lee, Yin Tat Lee, Yuanzhi Li, Scott M. Lundberg, Harsha Nori, Hamid Palangi, Marco Túlio Ribeiro, and Yi Zhang. Sparks of artificial general intelligence: Early experiments with GPT-4. CoRR, abs/2303.12712, 2023. doi: 10.48550/arXiv.2303.12712. URLhttps://doi.org/10. $48550 / a r X i v .2303 .12712$

Cristian Buciluă, Rich Caruana, and Alexandru Niculescu-Mizil. Model compression. In Proceedings of the 12th ACM SIGKDD international conference on Knowledge discovery and data mining, pp. $535-541,2006$.

Wenhu Chen, Xueguang Ma, Xinyi Wang, and William W Cohen. Program of thoughts prompting: Disentangling computation from reasoning for numerical reasoning tasks. arXiv preprint arXiv:2211.12588, 2022.

Karl Cobbe, Vineet Kosaraju, Mohammad Bavarian, Mark Chen, Heewoo Jun, Lukasz Kaiser, Matthias Plappert, Jerry Tworek, Jacob Hilton, Reiichiro Nakano, Christopher Hesse, and John Schulman. Training verifiers to solve math word problems, 2021. URLhttps://arxiv.org/ $\mathrm{abs} / 2110.14168$.

Tri Dao. FlashAttention-2: Faster attention with better parallelism and work partitioning. 2023.

Edward A Feigenbaum, Julian Feldman, et al. Computers and thought, volume 7. New York McGraw-Hill, 1963.

Yao Fu, Hao Peng, Litu Ou, Ashish Sabharwal, and Tushar Khot. Specializing smaller language models towards multi-step reasoning. In Andreas Krause, Emma Brunskill, Kyunghyun Cho, Barbara Engelhardt, Sivan Sabato, and Jonathan Scarlett (eds.), International Conference on Machine Learning, ICML 2023, 23-29 July 2023, Honolulu, Hawaii, USA, volume 202 of Proceedings of Machine Learning Research, pp. 10421-10430. PMLR, 2023. URL https://proceedings.mlr.press/v202/fu23d.html.

Luyu Gao, Aman Madaan, Shuyan Zhou, Uri Alon, Pengfei Liu, Yiming Yang, Jamie Callan, and Graham Neubig. Pal: Program-aided language models. arXiv preprint arXiv:2211.10435, 2022.

Zhibin Gou, Zhihong Shao, Yeyun Gong, Yelong Shen, Yujiu Yang, Nan Duan, and Weizhu Chen. Critic: Large language models can self-correct with tool-interactive critiquing. arXiv preprint arXiv:2305.11738, 2023.

Dan Hendrycks, Collin Burns, Saurav Kadavath, Akul Arora, Steven Basart, Eric Tang, Dawn Song, and Jacob Steinhardt. Measuring mathematical problem solving with the math dataset. NeurIPS, 2021.

Geoffrey Hinton, Oriol Vinyals, and Jeff Dean. Distilling the knowledge in a neural network. arXiv preprint arXiv:1503.02531, 2015.

Namgyu Ho, Laura Schmid, and Se-Young Yun. Large language models are reasoning teachers. In Proceedings of the 61st Annual Meeting of the Association for Computational Linguistics (Volume 1: Long Papers), pp. 14852-14882, Toronto, Canada, July 2023. Association for Computational Linguistics. doi: 10.18653/v1/2023.acl-long.830. URL https://aclanthology.org/ 2023.acl-long.830.

Mohammad Javad Hosseini, Hannaneh Hajishirzi, Oren Etzioni, and Nate Kushman. Learning to solve arithmetic word problems with verb categorization. In Proceedings of the 2014 Conference on Empirical Methods in Natural Language Processing (EMNLP), pp. 523-533, 2014.

Jiaxin Huang, Shixiang Shane Gu, Le Hou, Yuexin Wu, Xuezhi Wang, Hongkun Yu, and Jiawei Han. Large language models can self-improve. CoRR, abs/2210.11610, 2022. doi: 10.48550/arXiv.2210. 11610. URLhttps://doi.org/10.48550/arXiv.2210.11610

Weisen Jiang, Han Shi, Longhui Yu, Zhengying Liu, Yu Zhang, Zhenguo Li, and James T Kwok. Backward reasoning in large language models for verification. arXiv preprint arXiv:2308.07758, 2023.

Rik Koncel-Kedziorski, Subhro Roy, Aida Amini, Nate Kushman, and Hannaneh Hajishirzi. MAWPS: A math word problem repository. In Proceedings of the 2016 Conference of the North American Chapter of the Association for Computational Linguistics: Human Language Technologies, pp. 1152-1157, San Diego, California, June 2016. Association for Computational Linguistics. doi: 10.18653/v1/N16-1136. URLhttps://aclanthology.org/N16-1136.

Ariel N Lee, Cole J Hunter, and Nataniel Ruiz. Platypus: Quick, cheap, and powerful refinement of llms. arXiv preprint arXiv:2308.07317, 2023.

Yifei Li, Zeqi Lin, Shizhuo Zhang, Qiang Fu, Bei Chen, Jian-Guang Lou, and Weizhu Chen. Making language models better reasoners with step-aware verifier. In Proceedings of the 61st Annual Meeting of the Association for Computational Linguistics (Volume 1: Long Papers), pp. 5315-5333, 2023.

Tian Liang, Zhiwei He, Wenxiang Jiao, Xing Wang, Yan Wang, Rui Wang, Yujiu Yang, Zhaopeng Tu, and Shuming Shi. Encouraging divergent thinking in large language models through multi-agent debate. arXiv preprint arXiv:2305.19118, 2023.

Hunter Lightman, Vineet Kosaraju, Yura Burda, Harri Edwards, Bowen Baker, Teddy Lee, Jan Leike, John Schulman, Ilya Sutskever, and Karl Cobbe. Let's verify step by step. arXiv preprint arXiv:2305.20050, 2023.

Pan Lu, Liang Qiu, Kai-Wei Chang, Ying Nian Wu, Song-Chun Zhu, Tanmay Rajpurohit, Peter Clark, and Ashwin Kalyan. Dynamic prompt learning via policy gradient for semi-structured mathematical reasoning. In The Eleventh International Conference on Learning Representations, 2023. URLhttps://openreview.net/forum?id=DHyHRBwJUTN.

Haipeng Luo, Qingfeng Sun, Can Xu, Pu Zhao, Jianguang Lou, Chongyang Tao, Xiubo Geng, Qingwei Lin, Shifeng Chen, and Dongmei Zhang. Wizardmath: Empowering mathematical reasoning for large language models via reinforced evol-instruct. arXiv preprint arXiv:2308.09583, 2023.

Grégoire Mialon, Roberto Dessì, Maria Lomeli, Christoforos Nalmpantis, Ram Pasunuru, Roberta Raileanu, Baptiste Rozière, Timo Schick, Jane Dwivedi-Yu, Asli Celikyilmaz, et al. Augmented language models: a survey. arXiv preprint arXiv:2302.07842, 2023.

Shen-yun Miao, Chao-Chun Liang, and Keh-Yih Su. A diverse corpus for evaluating and developing English math word problem solvers. In Proceedings of the 58th Annual Meeting of the Association for Computational Linguistics, pp. 975-984, Online, July 2020. Association for Computational Linguistics. doi: 10.18653/v1/2020.acl-main.92. URL https://aclanthology.org/ 2020.acl-main. 92

Swaroop Mishra, Matthew Finlayson, Pan Lu, Leonard Tang, Sean Welleck, Chitta Baral, Tanmay Rajpurohit, Oyvind Tafjord, Ashish Sabharwal, Peter Clark, and Ashwin Kalyan. Lila: A unified benchmark for mathematical reasoning. In Proceedings of the 2022 Conference on Empirical Methods in Natural Language Processing (EMNLP), 2022.

Reiichiro Nakano, Jacob Hilton, Suchir Balaji, Jeff Wu, Long Ouyang, Christina Kim, Christopher Hesse, Shantanu Jain, Vineet Kosaraju, William Saunders, et al. Webgpt: Browser-assisted question-answering with human feedback. arXiv preprint arXiv:2112.09332, 2021.

OpenAI. Gpt-4 technical report, 2023.

Bhargavi Paranjape, Scott Lundberg, Sameer Singh, Hannaneh Hajishirzi, Luke Zettlemoyer, and Marco Tulio Ribeiro. Art: Automatic multi-step reasoning and tool-use for large language models. arXiv preprint arXiv:2303.09014, 2023.

Aaron Parisi, Yao Zhao, and Noah Fiedel. Talm: Tool augmented language models. arXiv preprint arXiv:2205.12255, 2022.

Arkil Patel, Satwik Bhattamishra, and Navin Goyal. Are NLP models really able to solve simple math word problems? In Proceedings of the 2021 Conference of the North American Chapter of the Association for Computational Linguistics: Human Language Technologies, pp. 2080-2094, Online, June 2021. Association for Computational Linguistics. doi: 10.18653/v1/2021.naacl-main. 168. URLhttps://aclanthology.org/2021.naacl-main. 168

Guilherme Penedo, Quentin Malartic, Daniel Hesslow, Ruxandra Cojocaru, Alessandro Cappelli, Hamza Alobeidli, Baptiste Pannier, Ebtesam Almazrouei, and Julien Launay. The RefinedWeb dataset for Falcon LLM: outperforming curated corpora with web data, and web data only. arXiv preprint arXiv:2306.01116, 2023. URLhttps://arxiv.org/abs/2306.01116.

Baolin Peng, Chunyuan Li, Pengcheng He, Michel Galley, and Jianfeng Gao. Instruction tuning with gpt-4. arXiv preprint arXiv:2304.03277, 2023.

Stanislas Polu and Ilya Sutskever. Generative language modeling for automated theorem proving. arXiv preprint arXiv:2009.03393, 2020.

Samyam Rajbhandari, Olatunji Ruwase, Jeff Rasley, Shaden Smith, and Yuxiong He. Zero-infinity: Breaking the gpu memory wall for extreme scale deep learning. In Proceedings of the International Conference for High Performance Computing, Networking, Storage and Analysis, pp. 1-14, 2021.

Baptiste Rozière, Jonas Gehring, Fabian Gloeckle, Sten Sootla, Itai Gat, Xiaoqing Ellen Tan, Yossi Adi, Jingyu Liu, Tal Remez, Jérémy Rapin, et al. Code llama: Open foundation models for code. arXiv preprint arXiv:2308.12950, 2023.

Timo Schick, Jane Dwivedi-Yu, Roberto Dessì, Roberta Raileanu, Maria Lomeli, Luke Zettlemoyer, Nicola Cancedda, and Thomas Scialom. Toolformer: Language models can teach themselves to use tools. arXiv preprint arXiv:2302.04761, 2023.

Zhihong Shao, Fei Huang, and Minlie Huang. Chaining simultaneous thoughts for numerical reasoning. In Yoav Goldberg, Zornitsa Kozareva, and Yue Zhang (eds.), Findings of the Association for Computational Linguistics: EMNLP 2022, Abu Dhabi, United Arab Emirates, December 7-11, 2022, pp. 2533-2547. Association for Computational Linguistics, 2022. doi: 10.18653/v1/2022.findings-emnlp.187. URL https://doi.org/10.18653/v1/2022. findings-emnlp. 187 .

Zhihong Shao, Yeyun Gong, Yelong Shen, Minlie Huang, Nan Duan, and Weizhu Chen. Synthetic prompting: Generating chain-of-thought demonstrations for large language models. In Andreas Krause, Emma Brunskill, Kyunghyun Cho, Barbara Engelhardt, Sivan Sabato, and Jonathan Scarlett (eds.), International Conference on Machine Learning, ICML 2023, 23-29 July 2023, Honolulu, Hawaii, USA, volume 202 of Proceedings of Machine Learning Research, pp. 30706-30775. PMLR, 2023a. URLhttps://proceedings.mlr.press/v202/shao23a.html.

Zhihong Shao, Yeyun Gong, Yelong Shen, Minlie Huang, Nan Duan, and Weizhu Chen. Enhancing retrieval-augmented large language models with iterative retrieval-generation synergy. CoRR, abs/2305.15294, 2023b. doi: 10.48550/arXiv.2305.15294. URL https://doi.org/10. 48550/arXiv. 2305.15294 .

Rohan Taori, Ishaan Gulrajani, Tianyi Zhang, Yann Dubois, Xuechen Li, Carlos Guestrin, Percy Liang, and Tatsunori B. Hashimoto. Stanford alpaca: An instruction-following llama model. https://github.com/tatsu-lab/stanford_alpaca, 2023.

Hugo Touvron, Thibaut Lavril, Gautier Izacard, Xavier Martinet, Marie-Anne Lachaux, Timothée Lacroix, Baptiste Rozière, Naman Goyal, Eric Hambro, Faisal Azhar, et al. Llama: Open and efficient foundation language models. arXiv preprint arXiv:2302.13971, 2023a.

Hugo Touvron, Louis Martin, Kevin Stone, Peter Albert, Amjad Almahairi, Yasmine Babaei, Nikolay Bashlykov, Soumya Batra, Prajjwal Bhargava, Shruti Bhosale, Dan Bikel, Lukas Blecher, Cristian Canton-Ferrer, Moya Chen, Guillem Cucurull, David Esiobu, Jude Fernandes, Jeremy Fu, Wenyin Fu, Brian Fuller, Cynthia Gao, Vedanuj Goswami, Naman Goyal, Anthony Hartshorn, Saghar Hosseini, Rui Hou, Hakan Inan, Marcin Kardas, Viktor Kerkez, Madian Khabsa, Isabel Kloumann, Artem Korenev, Punit Singh Koura, Marie-Anne Lachaux, Thibaut Lavril, Jenya Lee, Diana Liskovich, Yinghai Lu, Yuning Mao, Xavier Martinet, Todor Mihaylov, Pushkar Mishra, Igor Molybog, Yixin Nie, Andrew Poulton, Jeremy Reizenstein, Rashi Rungta, Kalyan Saladi, Alan Schelten, Ruan Silva, Eric Michael Smith, Ranjan Subramanian, Xiaoqing Ellen Tan, Binh Tang, Ross Taylor, Adina Williams, Jian Xiang Kuan, Puxin Xu, Zheng Yan, Iliyan Zarov, Yuchen Zhang, Angela Fan, Melanie Kambadur, Sharan Narang, Aurélien Rodriguez, Robert Stojnic, Sergey Edunov, and Thomas Scialom. Llama 2: Open foundation and fine-tuned chat models. CoRR, abs/2307.09288, 2023b. doi: 10.48550/arXiv.2307.09288. URL https://doi.org/ $10.48550 / a r X i v .2307 .09288$

Jason Wei, Xuezhi Wang, Dale Schuurmans, Maarten Bosma, brian ichter, Fei Xia, Ed H. Chi, Quoc V Le, and Denny Zhou. Chain of thought prompting elicits reasoning in large language models. In Alice H. Oh, Alekh Agarwal, Danielle Belgrave, and Kyunghyun Cho (eds.), Advances in Neural Information Processing Systems, 2022. URL https://openreview.net/forum? id=_VjQlMeSB_J.

Shunyu Yao, Jeffrey Zhao, Dian Yu, Nan Du, Izhak Shafran, Karthik R Narasimhan, and Yuan Cao. React: Synergizing reasoning and acting in language models. In The Eleventh International Conference on Learning Representations, 2023. URL https://openreview. net/forum? id=WE_vluYUL-X.

Zheng Yuan, Hongyi Yuan, Chengpeng Li, Guanting Dong, Chuanqi Tan, and Chang Zhou. Scaling relationship on learning mathematical reasoning with large language models. arXiv preprint arXiv:2308.01825, 2023.

Xiang Yue, Xingwei Qu, Ge Zhang, Yao Fu, Wenhao Huang, Huan Sun, Yu Su, and Wenhu Chen. Mammoth: Building math generalist models through hybrid instruction tuning. arXiv preprint arXiv:2309.05653, 2023.

Eric Zelikman, Yuhuai Wu, Jesse Mu, and Noah Goodman. Star: Bootstrapping reasoning with reasoning. Advances in Neural Information Processing Systems, 35:15476-15488, 2022.

Beichen Zhang, Kun Zhou, Xilin Wei, Wayne Xin Zhao, Jing Sha, Shijin Wang, and Ji-Rong Wen. Evaluating and improving tool-augmented computation-intensive math reasoning. arXiv preprint arXiv:2306.02408, 2023.

Aojun Zhou, Ke Wang, Zimu Lu, Weikang Shi, Sichun Luo, Zipeng Qin, Shaoqing Lu, Anya Jia, Linqi Song, Mingjie Zhan, et al. Solving challenging math word problems using gpt-4 code interpreter with code-based self-verification. arXiv preprint arXiv:2308.07921, 2023a.

Denny Zhou, Nathanael Schärli, Le Hou, Jason Wei, Nathan Scales, Xuezhi Wang, Dale Schuurmans, Claire Cui, Olivier Bousquet, Quoc V. Le, and Ed H. Chi. Least-to-most prompting enables complex reasoning in large language models. In The Eleventh International Conference on Learning Representations, ICLR 2023, Kigali, Rwanda, May 1-5, 2023. OpenReview.net, 2023b. URLhttps://openreview.net/pdf?id=WZH7099tg£M

Xinyu Zhu, Junjie Wang, Lin Zhang, Yuxiang Zhang, Yongfeng Huang, Ruyi Gan, Jiaxing Zhang, and Yujiu Yang. Solving math word problems via cooperative reasoning induced language models. In Proceedings of the 61st Annual Meeting of the Association for Computational Linguistics (Volume 1: Long Papers), pp. 4471-4485, Toronto, Canada, July 2023. Association for Computational Linguistics. doi: 10.18653/v1/2023.acl-long.245. URL https://aclanthology.org/ 2023.acl-long. 245 .
