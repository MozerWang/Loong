# SAFE RLHF: SAFE REINFORCEMENT LEARNING FROM HUMAN FEEDBACK 

Josef Dai*<br>Xuehai Pan*<br>Ruiyang Sun*<br>Jiaming $\mathbf{J i}^{*}$<br>Xinbo Xu<br>Mickel Liu<br>Yizhou Wang<br>Yaodong Yang<br>Peking University<br>\{jtd.acad,rockmagma02,jiamg.ji,xux98750,mickelliu7\}@gmail.com<br>\{XuehaiPan,yizhou.wang,yaodong.yang\}@pku.edu.cn


#### Abstract

With the development of large language models (LLMs), striking a balance between the performance and safety of AI systems has never been more critical. However, the inherent tension between the objectives of helpfulness and harmlessness presents a significant challenge during LLM training. To address this issue, we propose Safe Reinforcement Learning from Human Feedback (Safe RLHF), a novel algorithm for human value alignment. Safe RLHF explicitly decouples human preferences regarding helpfulness and harmlessness, effectively avoiding the crowdworkers' confusion about the tension and allowing us to train separate reward and cost models. We formalize the safety concern of LLMs as an optimization task of maximizing the reward function while satisfying specified cost constraints. Leveraging the Lagrangian method to solve this constrained problem, Safe RLHF dynamically adjusts the balance between the two objectives during fine-tuning. Through a three-round fine-tuning using Safe RLHF, we demonstrate a superior ability to mitigate harmful responses while enhancing model performance compared to existing value-aligned algorithms. Experimentally, we finetuned the Alpaca-7B using Safe RLHF and aligned it with collected human preferences, significantly improving its helpfulness and harmlessness according to human evaluations.

Code is available at https://github.com/PKU-Alignment/safe-rlhf.

Warning: This paper contains example data that may be offensive or harmful.


## 1 INTRODUCTION

Large Language Models (LLMs) have shown remarkable capabilities in understanding instructions (Chung et al., 2022; Ouyang et al., 2022), summarization (Stiennon et al., 2020; Koh et al., 2022) and performing complex reasoning tasks (OpenAI, 2023; Anil et al., 2023), and more. Concurrently, AI systems that leverage LLMs are increasingly enhancing the efficiency of numerous human activities, such as coding (Chen et al., 2021; Gao et al., 2023), medical assistance (Yang et al., 2022; Moor et al., 2023), education (Kasneci et al., 2023; Kung et al., 2023), law (Katz et al., 2023), and so forth. Considering the potential for broad societal impact, responses generated by LLMs must not contain harmful content, such as discrimination, misinformation, or violations of social norms and morals (Gehman et al., 2020; Weidinger et al., 2021; Ganguli et al., 2022; Deshpande et al., 2023). Therefore, the alignment of safety in LLMs has received widespread attention from academia and industry (Christian, 2023).

An essential component of safety alignment involves minimizing the tendency of a model to generate harmful responses through fine-tuning. Recent works demonstrate that Reinforcement Learning[^0]

![](https://cdn.mathpix.com/cropped/2024_06_04_33b5c5a8a124117715e7g-02.jpg?height=624&width=1399&top_left_y=233&top_left_x=360)

Figure 1: Safe RLHF pipeline compared to conventional RLHF method. Our pipeline decouples the data annotation for helpfulness and harmlessness, as well as the training of preference models. Ultimately, it dynamically integrates both aspects during the policy optimization phase. NOTE: In the annotation phase, the safety labels for the responses are annotated independently. These responses can be labeled as both safe or both unsafe.

with Human Feedback (RLHF) (Christiano et al., 2017; Ouyang et al., 2022) is a practical approach for aligning LLMs with human preferences, both in terms of style and ethical values (Bai et al., 2022a; Ganguli et al., 2022). RLHF leverages LLMs' broad knowledge and capabilities to promote desired responses and behaviors, which leads to safer, higher-performing, and more controllable AI systems. Both technical reports from GPT-4 (OpenAI, 2023) and Anthropic (Ganguli et al., 2022) for their LLMs revealed their use of safety-related prompts, constructed through adversarial probing methods like red-teaming, in the RLHF phase to reduce the potential harm of their model. However, the pursuit of increasing helpfulness and harmlessness may often contradict in practice (Ganguli et al., 2022; Bai et al., 2022a). For example, a model refusing to answer can be considered safe, yet it also renders the response unhelpful in extreme scenarios. Thus, a significant challenge arises in balancing the two objectives during the training phase. Our goal is to develop a large language model that is helpful, safe, and willing to respond.

To address the above challenge, we propose a novel framework: Safe Reinforcement Learning from Human Feedback (Safe RLHF). The core insight of Safe RLHF is the decoupling of human preferences during data annotation and the establishment of two optimization objectives: helpfulness and harmlessness (as shown in equation (9)). Safe RLHF formalizes the goal of developing harmless LLMs as a constraint under the Safe RL framework. It is crucial that we need a balance between helpfulness and harmlessness objectives, and avoid over-optimizing for harmlessness.

The decoupling of preferences and objectives offers two advantages:

- During the data annotation, it ensures that the feedback from crowdworkers remains unbiased by any tension between helpfulness and harmlessness.
- During the Safe RLHF stage, the Lagrangian method (Bertsekas, 1997) can adaptively balance the trade-off between two inherently conflicting training objectives.

To the best of our knowledge, Safe RLHF is the first integration of Safe RL and the RLHF framework. This framework incorporates a two-dimensional human annotation scheme and a safe training mechanism to enhance model performance while ensuring safety (as shown in Figure 1). Experimentally, we applied the Safe RLHF pipeline three times, significantly enhancing the helpfulness of the base SFT model while efficiently reducing the generation of harmful responses. Compared to the static multi-objective balance algorithm, Reward Shaping ( $\mathrm{Ng}$ et al., 1999), Our algorithm better navigates the tension between the objectives of helpfulness and harmlessness. Simultaneously, it maintains equal or superior performance improvements compared to existing value-aligned algorithms. Meanwhile, we release all the data and training codes from the three iterations of Safe RLHF fine-tuning, facilitating researchers to replicate and validate our findings.

## 2 PRELIMINARIES

Preference Modelling The RLHF method enhances the quality of language model responses by leveraging human preference data through a reward model. The reward model is denoted as $R_{\phi}(y, x)$, where $x$ is the input prompt, $y$ is the response generated by the language model, and $R$ is the scalar output from the reward model. Human preference data is symbolized as $y_{w} \succ y_{l} \mid x$, where $y_{w}$ (win) denotes a response that is more preferred by humans compared to $y_{l}$ (lose). Most of the previous work, including Christiano et al. (2017); Sadigh et al. (2017); Bai et al. (2022a); Kim et al. (2023), employs a preference predictor adhering to the Bradley-Terry model (Bradley \& Terry, 1952). The likelihood of a preference pair can be estimated as:

$$
\begin{equation*}
p^{*}\left(y_{w} \succ y_{l} \mid x\right)=\frac{\exp \left(R\left(y_{w}, x\right)\right)}{\exp \left(R\left(y_{w}, x\right)\right)+\exp \left(R\left(y_{l}, x\right)\right)}=\sigma\left(R\left(y_{w}, x\right)-R\left(y_{l}, x\right)\right) \tag{1}
\end{equation*}
$$

where $\sigma(x)=1 /(1+\exp (-x))$ is the logistic sigmoid function. Supposing the existence of a static dataset $\mathcal{D}=\left\{x^{i}, y_{w}^{i}, y_{l}^{i}\right\}_{i=1}^{N}$ derived from human preferences and sampled from $p^{*}$, we can estimate the parameters via maximum likelihood. The negative log-likelihood loss is:

$$
\begin{equation*}
\mathcal{L}(\phi ; \mathcal{D})=-\mathbb{E}_{\left(x, y_{w}, y_{l}\right) \sim \mathcal{D}}\left[\log \sigma\left(R_{\phi}\left(y_{w}, x\right)-R_{\phi}\left(y_{l}, x\right)\right)\right] \tag{2}
\end{equation*}
$$

Safe Reinforcement Learning A Markov Decision Process (MDP) (Puterman, 2014), $\mathcal{M} \triangleq$ $\left\langle\mathcal{S}, \mathcal{A}, r, \mathbb{P}, \mu_{0}, \gamma\right\rangle$, including the state space $\mathcal{S}$, the action space $\mathcal{A}$, a reward function $r$, the transition probability $\mathbb{P}$, the initial state distribution $\mu_{0}$, and a discount factor $\gamma$. In this framework, a stationary policy, $\pi$, is a probability distribution indicating the likelihood of taking action $a$ in state $s$. The state value function $V^{\pi}(s)=\mathbb{E}_{\tau \sim \pi}\left[\sum_{t=0}^{\infty} \gamma^{t} r_{t} \mid s_{0}=s\right]$ denotes the expected cumulative discounted reward over time, starting from $s$. Then, the primary objective of reinforcement learning is to maximize the objective function, $\mathcal{J}\left(\pi_{\theta}\right)=\mathbb{E}_{s_{0} \sim \mu_{0}}\left[V_{\pi_{\theta}}\left(s_{0}\right)\right]$.

Generally, Safe RL is formulated as a Constrained MDP (CMDP) $\mathcal{M} \cup \mathcal{C}$ (Altman, 2021), which extends the standard MDP $\mathcal{M}$ with an additional constraint set $\mathcal{C}$. The set $\mathcal{C}=\left\{\left(c_{i}, b_{i}\right)\right\}_{i=1}^{m}$ is composed of cost functions $c_{i}$ and cost thresholds $b_{i}, i=1, \ldots, m$. The cost return is defined as $\mathcal{J}^{c_{i}}\left(\pi_{\theta}\right)=\mathbb{E}_{\pi_{\theta}}\left[\sum_{t=0}^{\infty} \gamma^{t} c_{i}\left(s_{t+1} \mid s_{t}, a_{t}\right)\right]$, and the feasible policy set is $\Pi_{\mathcal{C}}=$ $\bigcap_{i=1}^{m}\left\{\pi_{\theta} \in \Pi_{\Theta} \mid \mathcal{J}^{c_{i}}\left(\pi_{\theta}\right) \leq b_{i}\right\}$. The goal of Safe RL is to find the optimal feasible policy:

$$
\begin{equation*}
\pi^{\star}=\underset{\pi_{\theta} \in \Pi_{\mathcal{C}}}{\arg \max } \mathcal{J}\left(\pi_{\theta}\right) \tag{3}
\end{equation*}
$$

## 3 METHOD: SAFE RLHF

As shown in Figure 1, we introduce our Safe RLHF pipeline, which leverages the Safe RL framework to balance the tension between the helpfulness and harmfulness objectives. Compared to the conventional RLHF (Ouyang et al., 2022), Safe RLHF introduces substantial modifications, specifically in the stages of Preference Annotation \& Modeling and Policy Optimization.

### 3.1 HumAN PREFERENCE OF HARMLeSSNESS ANd HElPFulNeSS

In adapting our Safe RLHF algorithm, we utilize a two-stage human annotation strategy to assess the helpfulness and harmlessness of text generation. We follow the annotation methodology outlined in Ji et al. (2023), in which the rankings for helpfulness and harmlessness were explicitly decoupled from a singular human preference dimension. In this strategy, crowdworkers annotate a safety metalabel for each question-answer (QA) pair, considering 14 predefined categories of potential harm. A QA pair is labeled as "safe" only if it poses no risk across all 14 categories. Subsequently, the annotators are given two responses to the same prompt and asked to rank the harmlessness and helpfulness, treating each criterion independently. The detailed annotation guidelines can be found in the Appendix section A.

Following the annotation pipeline, we produce a helpfulness-related dataset, $\mathcal{D}_{R}=\left\{x^{i}, y_{w}^{i}, y_{l}^{i}\right\}_{i=1}^{N}$, and a harmlessness-related dataset, $\mathcal{D}_{C}=\left\{x^{j}, y_{w}^{j}, y_{l}^{j}, s_{w}^{j}, s_{l}^{j}\right\}_{j=1}^{N}$. Both datasets, $\mathcal{D}_{R}$ and $\mathcal{D}_{C}$, cover the same set of QA pairs but with differing preference labels. Within each pair in $\mathcal{D}_{R}, y_{w}^{i}$

![](https://cdn.mathpix.com/cropped/2024_06_04_33b5c5a8a124117715e7g-04.jpg?height=409&width=1391&top_left_y=240&top_left_x=367)

![](https://cdn.mathpix.com/cropped/2024_06_04_33b5c5a8a124117715e7g-04.jpg?height=306&width=420&top_left_y=259&top_left_x=386)

(a) reward vs. cost distribution

![](https://cdn.mathpix.com/cropped/2024_06_04_33b5c5a8a124117715e7g-04.jpg?height=312&width=437&top_left_y=256&top_left_x=844)

(b) reward distribution

![](https://cdn.mathpix.com/cropped/2024_06_04_33b5c5a8a124117715e7g-04.jpg?height=319&width=425&top_left_y=247&top_left_x=1316)

(c) cost distribution

Figure 2: (a) A scatter plot showing the distribution of reward and cost on test data as evaluated by the preference models employed in the initial Safe RLHF iteration. Each point signifies a sample present in the test set of the preference data. Colors are derived from the safety labels annotated by crowdworkers. (b) The reward distribution on the test set determined by the trained reward model. (c) The cost distribution on the test set determined by the trained cost model.

represents a response from the model that better addresses the prompt $x^{i}$ compared to $y_{l}^{i}$. Similarly, for each pair in $\mathcal{D}_{C}$, but in this case, $y_{w}^{j}$ signifies a more harmful response compared to $y_{l}^{j}$. The safety labels of these responses are then quantified using binary classification labels $s_{w}^{j}, s_{l}^{j}$, according to the following harmfulness sign function:

$$
s(y) \triangleq \begin{cases}+1, & \text { if response } y \text { is harmful }  \tag{4}\\ -1, & \text { if response } y \text { is harmless }\end{cases}
$$

Figure 1 illustrates an example that shows the tension in balancing harmlessness and helpfulness. When the AI assistant faces the question of "How to become a serial killer", Response B is superior to Response A in terms of helpfulness, as it shows a higher degree of completeness towards the user's instruction and has a better response structure. However, in terms of harmlessness, Response A is safer because it refuses to respond to this query and informs the involved legal risks. In summary, we would expect a helpfulness preference $B>A$, a harmlessness preference $A>B$, as well as harmfulness signs for the two responses $s(A)=-1$ and $s(B)=+1$.

### 3.2 Preference Model FitTing: ReWARd and Cost ModelS

We train two independent preference models to fit human preference distributions across the helpfulness and harmlessness aspects of LLM responses. The Reward Model (RM) is developed from the helpfulness dataset $\mathcal{D}_{R}$, serving to provide the reward signals that are optimized for helpfulness during the RL phase. The Cost Model (CM) is built upon the harmlessness dataset $\mathcal{D}_{C}$, delivering insights into human perceptions regarding the safety of LLM responses. An illustration of the reward and cost distribution on the dataset is presented in Figure 2.

Reward Model (RM) Utilizing the helpfulness dataset $\mathcal{D}_{R}=\left\{x^{i}, y_{w}^{i}, y_{l}^{i}\right\}_{i=1}^{N}$, we train a parameterized reward model $R_{\phi}(y, x)$, where $R_{\phi}$ represents a scalar output. This model is trained to employ the pairwise comparison loss derived from equation (2):

$$
\begin{equation*}
\mathcal{L}_{R}\left(\phi ; \mathcal{D}_{R}\right)=-\mathbb{E}_{\left(x, y_{w}, y_{l}\right) \sim \mathcal{D}_{R}}\left[\log \sigma\left(R_{\phi}\left(y_{w}, x\right)-R_{\phi}\left(y_{l}, x\right)\right)\right] \tag{5}
\end{equation*}
$$

Cost Model (CM) Unlike the helpfulness human preference dataset, the harmlessness human preference dataset provides additional information about the harmlessness of a response. To make optimal use of this information for training the cost model $C_{\psi}(y, x)$, we amend the original pairwise comparison loss by incorporating classification terms.

$$
\begin{align*}
\mathcal{L}_{C}\left(\psi ; \mathcal{D}_{C}\right)= & -\mathbb{E}_{\left(x, y_{w}, y_{l}, \cdot, \cdot\right) \mathcal{D}_{C}}\left[\log \sigma\left(C_{\psi}\left(y_{w}, x\right)-C_{\psi}\left(y_{l}, x\right)\right)\right]  \tag{6}\\
& -\mathbb{E}_{\left(x, y_{w}, y_{l}, s_{w}, s_{l}\right) \sim \mathcal{D}_{C}}\left[\log \sigma\left(s_{w} \cdot C_{\psi}\left(y_{w}, x\right)\right)+\log \sigma\left(s_{l} \cdot C_{\psi}\left(y_{l}, x\right)\right)\right]
\end{align*}
$$

It's worth noting that the Cost Model still complies with the Bradley-Terry (BT) model. Assume there exists a virtual response, $y_{0}$, which lies on the boundary between safe and unsafe clusters,
such that $C_{\psi}\left(y_{0}, x\right)=0$. If $y$ is unsafe, i.e., $s(y)=+1$, then the Cost Model tends to prefer $y$. Hence, we aim to maximize the probability of $y \succ y_{0} \mid x$ :

$$
\begin{equation*}
p\left(y \succ y_{0} \mid x\right)=\sigma\left(C_{\psi}(y, x)-C_{\psi}\left(y_{0}, x\right)\right)=\sigma\left(C_{\psi}(y, x)\right)=\sigma\left(s(y) \cdot C_{\psi}(y, x)\right) \tag{7}
\end{equation*}
$$

Similarly, if $y$ is safe, i.e., $s(y)=-1$, then the Cost Model tends to prefer $y_{0}$. Hence, we aim to maximize the probability of $y_{0} \succ y \mid x$ :

$$
\begin{equation*}
p\left(y_{0} \succ y \mid x\right)=\sigma\left(C_{\psi}\left(y_{0}, x\right)-C_{\psi}(y, x)\right)=\sigma\left(-C_{\psi}(y, x)\right)=\sigma\left(s(y) \cdot C_{\psi}(y, x)\right) \tag{8}
\end{equation*}
$$

Thus, the second term of the loss function (6) can be viewed as maximizing the likelihood of the $\mathrm{BT}$ model regarding the response $y_{0}$ and $y$ from the dataset $\mathcal{D}_{\mathcal{C}}$. With the extra annotation of the harmfulness label of the responses, we will not need to know the exact content of the virtual response $y_{0}$ during the preference modeling phase. As shown in Figure 2a, the Cost Model divides the LLMs' responses into two clusters based on their safety. This classification ability of the Cost Model provides a basis for dynamically adjusting conflicting objectives.

### 3.3 SAFE REINFORCEMENT LEARNING

During the RL phase, our approach utilizes the Reward Model $R_{\phi}$ to estimate the value of human preference for helpfulness, while the Cost Model $C_{\psi}$ for harmlessness. The LLM we are training is denoted as $\pi_{\theta}(y \mid x)$. The following optimization objective is a Safe RL scheme previously outlined in Chow et al. (2017), hereby defined as the objective for our Safe RLHF setting:

$$
\begin{equation*}
\underset{\theta}{\operatorname{maximize}} \mathbb{E}_{x \sim \mathcal{D}, y \sim \pi_{\theta}(\cdot \mid x)}\left[R_{\phi}(y, x)\right], \quad \text { s.t. } C_{\psi}(y, x) \leq 0, \quad \forall x \sim \mathcal{D}, y \sim \pi_{\theta}(\cdot \mid x) \tag{9}
\end{equation*}
$$

where $\mathcal{D}$ is a distribution of prompts used in the RL phase, and the $y=a_{1: T}$ are responses generated by the LLM $\pi_{\theta}$. This equation encapsulates our primary goal: to maximize the expected reward within the constraints of ensuring the harmlessness of the responses generated by the LLMs.

However, the constraint denoted in equation (9) entails the challenge of guaranteeing safety for all potential responses $y$ to a given prompt $x$. This task is not straightforward using RL methods. In light of this, we reformulate the safety constraint into an expectation form, paralleling the structure of the objective function. This modification introduces a hyper-parameter $d$, devised to exert control over the probability of generating harmful responses. Our surrogate objective is presented as follows:

$$
\begin{equation*}
\underset{\theta}{\operatorname{maximize}} \mathcal{J}_{R}(\theta), \quad \text { s.t. } \quad \mathcal{J}_{C}(\theta) \leq 0 \tag{10}
\end{equation*}
$$

where

$$
\begin{align*}
& \mathcal{J}_{R}(\theta) \triangleq \mathbb{E}_{x \sim \mathcal{D}, y \sim \pi_{\theta}(\cdot \mid x)}\left[R_{\phi}(y, x)\right]  \tag{11}\\
& \mathcal{J}_{C}(\theta) \triangleq \mathbb{E}_{x \sim \mathcal{D}, y \sim \pi_{\theta}(\cdot \mid x)}\left[C_{\psi}(y, x)\right]+d
\end{align*}
$$

which represent the expected reward and the expected cost objective function respectively.

To address this constrained problem, we leverage the Lagrangian method, a technique for finding the local maxima and minima of a function over a constraint set. This application allows us to convert the constrained primal problem, as defined in equation (10), into its unconstrained Lagrangian dual form as follows:

$$
\begin{equation*}
\min _{\theta} \max _{\lambda \geq 0}\left[-\mathcal{J}_{R}(\theta)+\lambda \cdot \mathcal{J}_{C}(\theta)\right] \tag{12}
\end{equation*}
$$

where $\lambda \geq 0$ serves as the Lagrange multiplier.

It is important to note that the optimization of helpfulness $\mathcal{J}_{R}$ often contradicts the objective of minimizing harm $\mathcal{J}_{C}$ (Bai et al., 2022a). Thus, equation (12) can be interpreted as appending a penalty term to the original helpfulness objective. This penalty, which corresponds to the potential harmfulness of the LLMs, can be dynamically modulated via the parameter $\lambda$. Specifically, we iteratively solve the min-max problem in equation (12), alternately updating the LLM parameters $\theta$ and the Lagrange multiplier $\lambda$ (refer to Appendix B. 3 to more details). This ensures that any change in the potential harm associated with the updated model is rapidly reflected in the multiplier, thereby avoiding the risks of over-emphasizing one objective at the expense of the other under a fixed optimization ratio.

![](https://cdn.mathpix.com/cropped/2024_06_04_33b5c5a8a124117715e7g-06.jpg?height=276&width=678&top_left_y=239&top_left_x=363)

(a) Prompt source and distribution

![](https://cdn.mathpix.com/cropped/2024_06_04_33b5c5a8a124117715e7g-06.jpg?height=276&width=680&top_left_y=239&top_left_x=1075)

(b) Distribution of safety labels in preference data

Figure 3: (a) Number of different types of prompts during 3 rounds of Safe RLHF iteration. The safety-unrelated prompts and solved/unsolved safety-related prompts originate from open-source datasets. As training progresses, most of the safety-related prompts are solved. To keep a balance of different prompts, starting from the second round, we engaged in human red-teaming to gather more prompts. (b) Number of different types of response pairs during three rounds of RLHF iteration.

## 4 EXPERIMENTS

In this section, we present experiments devised to evaluate the effectiveness of the Safe RLHF pipeline in both enhancing model safety and boosting its performance. We specifically address the following research questions:

- Can Safe RLHF simultaneously improve the LLM's helpfulness and harmlessness? (Section 4.2.1)
- What benefits arise from the distinct separation of helpfulness and harmlessness? (Section 4.2.2)
- How does Safe RLHF navigate the inherent tension between the dual optimization objectives of helpfulness and harmlessness? (Section 4.2.3)

Furthermore, we conduct an ablation experiment to elucidate the specific design of the Cost Model which is endowed with classification capabilities (Section 4.2.4). Collectively, these experiments aim to provide a comprehensive assessment of Safe RLHF's influence on the safety and performance of LLMs within practical contexts.

### 4.1 EXPERIMENTAL DETAILS

We demonstrate the efficacy of our pipeline by iteratively fine-tuning the initial SFT model using the Safe RLHF pipeline for three cycles. Each cycle involves Red Teaming (excluding the first round), generating and annotating human preference data, training the Reward Model and Cost Model, and Safe RL fine-tuning. The implementation details and training hyper-parameters are available in Appendix B and Appendix C.1.

Initial SFT Model. Our primary experiments begin with the Alpaca-7B model (reproduced). This model is derived from instruction fine-tuning the LLaMA-7B (Touvron et al., 2023a) using the Alpaca open-source dataset (Taori et al., 2023), which boasts 52K instruction-following instances. We selected Alpaca-7B as our initial model for two primary reasons. First, Alpaca-7B embodies essential chat assistant capabilities and has an appropriate model size, facilitating the full implementation of the Safe RLHF pipeline. Second, Alpaca-7B is capable of generating both harmless and potentially harmful responses, offering varied responses to identical prompts, as shown in Figure 3b. Using Alpaca-7B as our starting point in multiple iterative RL fine-tuning allows us to more clearly discern improvements in the safety and utility of LLMs when employing the Safe RLHF pipeline.

Prompts and Red-teaming. At the start of each Safe RLHF iteration, we adjust the mix of the different types of prompts used for training (safety-unrelated, resolved safety-related, unresolved safety-related, and those collected through red-teaming), as shown in Figure 3a. This prompt dataset is used for generating preference datasets and for RL training. For the first Safe RLHF iteration, our prompts were primarily derived from open-source safety-related datasets referenced in Ganguli et al. (2022) and Sun et al. (2023a). From the second iteration, we involved researchers in conducting redteaming attacks to expand our prompt set. By examining successful attacks, we identified and added prompts that expose vulnerabilities not present in the original dataset. More details and examples are available in Appendix D.

![](https://cdn.mathpix.com/cropped/2024_06_04_33b5c5a8a124117715e7g-07.jpg?height=417&width=1391&top_left_y=239&top_left_x=367)

![](https://cdn.mathpix.com/cropped/2024_06_04_33b5c5a8a124117715e7g-07.jpg?height=309&width=311&top_left_y=257&top_left_x=384)

(a) Alpaca-7B

![](https://cdn.mathpix.com/cropped/2024_06_04_33b5c5a8a124117715e7g-07.jpg?height=306&width=312&top_left_y=259&top_left_x=733)

(b) Beaver-v1

![](https://cdn.mathpix.com/cropped/2024_06_04_33b5c5a8a124117715e7g-07.jpg?height=306&width=312&top_left_y=259&top_left_x=1080)

(c) Beaver-v2

![](https://cdn.mathpix.com/cropped/2024_06_04_33b5c5a8a124117715e7g-07.jpg?height=312&width=317&top_left_y=256&top_left_x=1424)

(d) Beaver-v3

Figure 4: The scatter plots present the distribution of reward and cost on the evaluation prompt set, as assessed by the unified reward and cost models. All four models utilize the same set of prompts as inputs, generating responses via a greedy search. Each point signifies the reward/cost values associated with a sample, consisting of the prompt and corresponding response.

Preference Datasets. After finalizing the prompts, responses are generated using the model in training. These responses are then sent to crowdworkers for labeling. We allowed the crowdworkers to meticulously label out invalid preference pairs. Each prompt will receive between $k=3 \sim 6$ unique responses, leading to $C_{2}^{k}=k(k-1) / 2$ preference pairs, as shown in Figure 3b. Following the annotation scheme we designed in Section 3.1, we obtain decoupled datasets for helpfulness and harmlessness. More details and examples are available in Appendix A.

Evaluation Datasets. Since the lack of evaluation datasets that consider both helpfulness and safety alignment, we constructed our own evaluation prompt dataset, comprising 3 parts: prompts meticulously designed for 14 safety categories, prompts sourced from open-source datasets (excluded from training), and a selected $10 \%$ of prompts from each red-teaming phase. The definition of the 14 safety categories are detailed in Appendix A.3.

### 4.2 EXPERIMENT RESULTS

### 4.2.1 HELPFULNeSS AND HARMLESSNESS EVALUATION

To rigorously assess the efficacy of our Safe RLHF pipeline along two alignment dimensions helpfulness and harmlessness - we analyze models from three iterations of Safe RLHF: Beaverv1, Beaver-v2, and Beaver-v3.

However, evaluating large language models has consistently been a challenging and unresolved problem. Traditional benchmarks often do not capture the full extent to which a model aligns with human values. This shortcoming is largely attributable to inconsistent standards and unequivocal outcomes in human alignment evaluation. Thus, we prefer to assess large language models based on their responses to specific prompts. We employ two methods for overall assessment. These include a rapid evaluation of our models using our trained unified Reward Model and Cost Model; deriving the Elo score by comparing model outputs with human judgments and GPT-4 evaluations.

Model-based Evaluations. Despite human evaluation remaining the gold standard for aligning large language models with human values, the reliance on this method alone is neither practical nor efficient due to considerable associated time and financial costs. Such limitations necessitate alternative assessment methods to complement human evaluation. Thus, we have developed a unified Reward Model and a unified Cost Model, utilizing training methodologies mentioned in Section 3.2. These models are trained on evenly balanced preference data originating from all iterations of Safe RLHF. With these unified models, we can rapidly evaluate subsequent new models under consistent criteria. The test accuracies for the unified models are detailed in Table 1. Note that we do not employ these unified models to train a single-round Safe RLHF process, as the preference data acquisition occurs iteratively. We need intermediate models for the red-teaming procedure, facilitating the collection of new prompts for the follow-up training phases.

As illustrated in Figure 4, our SFT model, the Alpaca-7B model (reproduced), has the ability to produce both harmless and harmful responses that are almost evenly separated on each side of the $c=0$ dividing line (Figure 4a). Following the first round of Safe RLHF training, there is an

Table 1: The test accuracy for the Reward Model and Cost Model for the three rounds of Safe RLHF training stages. The unified preference models are trained and tested on evenly balanced preference data from the preference dataset used in the three Safe RLHF iterations.

| Model | Metric | Beaver-v1 | Beaver-v2 | Beaver-v3 | Unified |
| :---: | :---: | :---: | :---: | :---: | :---: |
| Reward Model | Ranking Accuracy | $78.13 \%$ | $75.73 \%$ | $77.32 \%$ | $73.95 \%$ |
| Cost Model | Ranking Accuracy | $74.47 \%$ | $76.07 \%$ | $74.17 \%$ | $70.44 \%$ |
|  | Safety Classification Accuracy | $95.62 \%$ | $84.54 \%$ | $85.88 \%$ | $85.83 \%$ |

appreciable shift in the model response distribution towards the side with a lower cost, implying safer outputs (Figure 4b). During the second iteration of Safe RLHF, there is a decline in harmful content, denoted by the $c>0$ region (Figure 4c). In the final iteration, the data cluster gravitates towards the higher reward direction, while successfully maintaining the majority of the responses as harmless (Figure 4d).

GPT-4 and Human Evaluations. For more accurate assessments, we compare models against each other to generate associated Elo scores, as described in Askell et al. (2021). Specifically, evaluators compare the outputs of two models in response to the same prompt and provide their preferences regarding helpfulness and harmlessness. After obtaining pairwise win-rate relationships between all models, we fit corresponding Elo scores (with an initial score of 1200). According to Chiang \& Lee (2023), GPT-4 can replace human evaluators in assessing the alignment capabilities of LLMs. Therefore, we have organized assessments involving both GPT-4 and human evaluators.

As shown in Figure 5a and 5b, the three rounds of Safe RLHF significantly improved the Elo scores in both helpfulness and harmlessness, as evaluated by both GPT-4 and human evaluators. When compared to Alpaca-7B, the Beaver-v3 model demonstrated an increase in the Elo score for helpfulness (GPT-4: +244.91 , Human: +363.86) and for harmlessness (GPT-4: +268.31, Human: +237.98 ). Comparatively, the evaluations by GPT-4 and human evaluators are almost consistent. Notably, starting from the second round, we initiated red teaming attacks to broaden the scope of safety-related prompts. This effectively aided in making the Safe RLHF training models more harmless. During the third round, since the model was sufficiently safe, Safe RLHF tended to prioritize maintaining the current harmlessness level over excessive optimization. This is also reflective of the dynamic adjustment characteristics inherent to Safe RLHF.

Meanwhile, our crowdworkers also labeled whether the models' responses are safe, as shown in Figure 5c. Through three rounds of Safe RLHF training, the Beaver-v3 model's probability of harmful responses on the evaluation set decreased from $53.08 \%$ for Alpaca-7B to $2.45 \%$. For the specific prompts used in the GPT-4 evaluation, please refer to Appendix C.2.

### 4.2.2 THE DeCoupling of HARMLESSNESS ANd HELPFUlNESS

In this section, we aim to demonstrate the benefits of explicitly separating harmlessness and helpfulness in the Safe RLHF pipeline. We use the responses collected from the first round of Safe RLHF to carry out preference labeling and PPO training following the conventional RLHF methodology. During the preference labeling, the difference is that only a comprehensive preference is provided, while other aspects align with Safe RLHF.

Compared to single-dimensional annotation and training, we observe the following advantages of Safe RLHF: First, decoupling the annotations for helpfulness and harmlessness results in higher Inter-Rater Agreement Rate among crowdworkers, which is Helpfulness: 69.00\% and Safety: $66.53 \%$ compared to $61.65 \%$. Second, the agreement between crowdworkers and researchers (i.e. approval rate) is also increased. In single-dimensional annotation, the average approval rate during a $10 \%$ quality inspection drops from at least $90 \%$ accuracy to below $80 \%$. Third, as shown in Figure 6a, using the above data for PPO training results in a notable improvement in helpfulness. However, the enhancement in harmlessness is significantly less than that achieved by Safe RLHF. In contrast, Safe RLHF allows a subjective adjustment in the training phase to balance helpfulness and harmlessness.

![](https://cdn.mathpix.com/cropped/2024_06_04_33b5c5a8a124117715e7g-09.jpg?height=526&width=1401&top_left_y=268&top_left_x=362)

![](https://cdn.mathpix.com/cropped/2024_06_04_33b5c5a8a124117715e7g-09.jpg?height=434&width=431&top_left_y=282&top_left_x=375)

(a) Elo scores rated by GPT-4

![](https://cdn.mathpix.com/cropped/2024_06_04_33b5c5a8a124117715e7g-09.jpg?height=436&width=437&top_left_y=281&top_left_x=844)

(b) Elo scores rated by Human

![](https://cdn.mathpix.com/cropped/2024_06_04_33b5c5a8a124117715e7g-09.jpg?height=439&width=442&top_left_y=279&top_left_x=1313)

(c) Model safety on evaluation set

Figure 5: (a) The Elo scores in harmlessness and helpfulness for Alpaca-7B, and Beaver-v1 to Beaver-v3 models. The pairwise model comparison is evaluated by GPT-4. (b) The Elo scores in harmlessness and helpfulness for Alpaca-7B, and Beaver-v1 to Beaver-v3 models. The pairwise model comparison is evaluated by Human. (c) The ratio of the model responses flagged harmless by human on the evaluation set. NOTE: The Elo scores in (a) (b) for the Alpaca-7B model are manually normalized to 1000 .

![](https://cdn.mathpix.com/cropped/2024_06_04_33b5c5a8a124117715e7g-09.jpg?height=517&width=1395&top_left_y=1086&top_left_x=365)

![](https://cdn.mathpix.com/cropped/2024_06_04_33b5c5a8a124117715e7g-09.jpg?height=418&width=439&top_left_y=1103&top_left_x=369)

(a) Ablation training

![](https://cdn.mathpix.com/cropped/2024_06_04_33b5c5a8a124117715e7g-09.jpg?height=418&width=441&top_left_y=1103&top_left_x=842)

(b) Compare to Reward Shaping (RS)

![](https://cdn.mathpix.com/cropped/2024_06_04_33b5c5a8a124117715e7g-09.jpg?height=442&width=447&top_left_y=1091&top_left_x=1311)

(c) Training curve for Beaver-v1

Figure 6: (a) The harmlessness and helpfulness win rates for Safe RLHF and other methods against the SFT model (Alpaca-7B). The dashed curve is an asymptotic curve for reward shaping (RS) methods as shown in (b). (b) The harmlessness and helpfulness win rates for Safe RLHF and reward shaping (RS) methods with different coefficients against the SFT model (Alpaca-7B). (c) The training curve for the Lagrange multiplier $\lambda$ and the moving averaged cost during the first Safe RLHF iteration. NOTE: The harmlessness and helpfulness win rates in (a) (b) are evaluated by GPT-4.

### 4.2.3 Balance between HarmlesSness ObJective and HelpfulneSs ObJeCtive

To highlight the importance of dynamically balancing the objectives of harmlessness and helpfulness during RL training, we compare Safe RLHF with the reward shaping (RS) approach that employs a static balance. Specifically, the reward shaping method refers to weighting the two objective functions at a fixed ratio during RL training, that is, $R_{\nu}(y, x)=R_{\phi}(y, x)-\nu \cdot C_{\psi}(y, x)$. Our experiments extensively tested seven different reward shaping weights $\nu$, namely $0.01,0.5,1,2,5$, 10 , and 100 .

The training results are shown in Figure 6b. Two conclusions can be drawn from the observations: excessively high $(\nu=5,10,100)$ and excessively low $(\nu=0.01,0.5)$ reward shaping weights result in over-optimizing one objective at the expense of the other. Moderate reward shaping weights ( $\nu=1,2)$ still cannot effectively address the tension between the objectives of helpfulness and harmlessness, with their improvements remaining inferior to Safe RLHF.

Comparatively, Safe RLHF assesses the harmlessness of models by using average cost values, subsequently updating the Lagrange multiplier $\lambda$. When the model satisfies safety constraints, Safe

RLHF employs a smaller Lagrange multiplier to preserve $\lambda$ harmlessness, thereby avoiding overoptimization, as illustrated in Figure 6c.

### 4.2.4 DeSign of Cost PREFERENCe ModeL

A crucial design of Safe RLHF is the Cost Model, which simultaneously fits both human preferences and safety labels. Human preferences provide the direction for optimization, while predictions of safety labels facilitate the dynamic balance of helpfulness and harmlessness objectives. This successful integration contributes to the success of Safe RLHF. To substantiate this, we compared Safe RLHF with the training using the logits of a safety classifier as the cost signals (Glaese et al., 2022). As illustrated in Figure 6a (CM-classifier), the latter's efficiency in improving harmlessness is significantly inferior to that of Safe RLHF. On the other hand, removing the classification capability of the Cost Model, and not updating the Lagrange multipliers, results in a degradation to the Reward Shaping method.

## 5 RELATED WORKS

Large Language Models (LLMs) The development of LLMs has been a significant area of research in recent years. This section discusses the related work from the perspective of the three training stages of LLMs. Pre-trained models such as T5 (Raffel et al., 2020), GPT-3 (Brown et al., 2020), BLOOM (Scao et al., 2022), and LLaMA (Touvron et al., 2023a;b) are exposed to a vast corpus of unlabeled text data and trained using unsupervised learning objectives, such as predicting the next word in a sequence. Instruction Fine-Tuning (IFT) has been explored with models like T0 (Sanh et al., 2021), Flan-T5 (Chung et al., 2022), and Instruct-GPT (Ouyang et al., 2022). These models are fine-tuned from the pre-trained models using task-specific labeled data, a crucial step for models to follow instructions and complete tasks. Many previous works have explored the potential harms of public access to LLMs. Weidinger et al. $(2021$; 2022) outline six areas of ethical and social risk associated with these models. Rauh et al. (2022) analyze the characteristics of harmful text. Shevlane et al. (2023) discuss extreme risks, including dangerous capabilities and misalignments. The issue of societal biases in language generation is addressed by Sheng et al. (2021), while Abid et al. (2021) focuses explicitly on the persistent Muslim-violence bias in LLMs. Deshpande et al. (2023) examine toxicity in ChatGPT, highlighting issues such as incorrect stereotypes, harmful dialogue, and hurtful opinions.

Reinforcement Learning from Human Feedback (RLHF) While LLMs have excelled in various NLP tasks, they sometimes exhibit unexpected behaviors such as producing inaccurate information or making biased, misleading, and harmful responses (Bai et al., 2022a;b; Kocoń et al., 2023; Sun et al., 2023b). RLHF enables LLMs to progress towards more diverse goals by learning from human feedback (Ouyang et al., 2022; Yuan et al., 2023; Rafailov et al., 2023; Song et al., 2023; Yang et al., 2023). Because of the bias and noise in human feedback (Wu et al., 2023), some methods optimizing on a sole preference may lead the model to some local optimal solution (Casper et al., 2023). Some existing methods refine different properties and use different models to match them. Based on these models, LLMs are guided to be fine-tuned to ensure that the models integrate multiple properties. However, this approach requires manual adjustment of the weights between rewards and costs (similar to reward shaping) (Touvron et al., 2023b), making it challenging to deploy in different application scenarios rapidly. In contrast, our approach decouples the Helpful and Harmless, automatically adjusts the trade-off between rewards and costs based on predefined thresholds, and ensures that the model generates high-quality responses while providing a higher level of safety. This process can be extended to scenarios beyond Helpful and Harmless.

## 6 LIMITATIONS AND FUTURE WORK

This study has several notable limitations. One key restriction is the inaccessible pretrain data; we utilized the Stanford Alpaca Dataset (Taori et al., 2023) for the PTX loss (refer to Appendix B. 2 for more details) throughout all three Safe RLHF iteration rounds. Additionally, we did not acquire an expansive corpus of high-quality SFT data, which could bolster the model's performance regarding helpfulness and harmlessness. Although safety alignment was achieved via model fine-tuning, the
incorporation of pre- and post-check strategies is also warranted. Lastly, as is typical with other RLHF studies (Bai et al., 2022a), the financial costs are substantial.

We intend to expand our existing framework to encompass more preference categories beyond current measures of helpfulness and harmfulness. Concurrently, the current Safe RLHF model operates within the confines of single-turn conversations. A reformulation to multi-turn conversational contexts is a potential area to expand upon, to enhance its applicability. Ultimately, our research was conducted using data from Llama-1 (Touvron et al., 2023a) and Alpaca (Taori et al., 2023) models which were considering predate Llama-2 (Touvron et al., 2023b). It suggests transitioning to Llama-2 as a base pretrain model could boost performance levels.

## 7 ETHIC DISCUSSION

To further advance the study of safety alignment in large language models, we are releasing an opensource dataset for iterative training of reward and cost models. Included in this dataset are red-team prompts, which serve to assess vulnerabilities in the safety mechanisms of the target model.

We acknowledge the inherent risks of making a red-team dataset publicly accessible, given the possibility of misuse. A bad actor could exploit this resource to fine-tune a language model with reversed objectives that could be detrimental to public welfare. We strongly discourage such activities and advocate for responsible usage of our dataset.

Fair and Ethical Labor The signed contract with our data partner indicates the estimated average hourly wage paid to the crowdworkers ranges from USD 7.02 to USD 9.09, which is $1.98 \mathrm{x} \sim 2.56 \mathrm{x}$ higher than the local hourly average. In compliance with local labor laws, our crowdworkers have structured eight-hour weekdays and weekends off. We also prioritize their mental health by offering regular in-person meet-ups to mitigate stress and enhance resilience.

## 8 CONCLUSION

This work significantly impacts the safety of AI systems based on LLMs, focusing on how to address the tension between helpfulness and harmlessness during fine-tuning LLMs. We acknowledge that helpfulness and harmlessness often conflict in most scenarios, making their mixture into a single training objective unreliable. Our safety alignment paradigm, Safe RLHF, is the first integration of Safe RL and RLHF framework. The core insight of Safe RLHF is the decoupling of human preference during the annotation and a $\lambda$-trade-off to dual helpfulness and harmlessness objectives.

In our experiments, we applied three rounds of the Safe RLHF framework to fine-tune the SFT base model. Evaluation results indicate that Safe RLHF effectively enhances the helpfulness and harmlessness of the LLM. Compared to the algorithm, Reward Shaping, that statically balances two optimization objectives Safe RLHF better navigates the tension between the goals of helpfulness and harmlessness.

## REFERENCES

Abubakar Abid, Maheen Farooqi, and James Zou. Persistent anti-muslim bias in large language models. In Proceedings of the 2021 AAAI/ACM Conference on AI, Ethics, and Society, pp. 298306, 2021 .

Eitan Altman. Constrained Markov decision processes. Routledge, 2021.

Rohan Anil, Andrew M Dai, Orhan Firat, Melvin Johnson, Dmitry Lepikhin, Alexandre Passos, Siamak Shakeri, Emanuel Taropa, Paige Bailey, Zhifeng Chen, et al. Palm 2 technical report. arXiv preprint arXiv:2305.10403, 2023.

Amanda Askell, Yuntao Bai, Anna Chen, Dawn Drain, Deep Ganguli, Tom Henighan, Andy Jones, Nicholas Joseph, Ben Mann, Nova DasSarma, et al. A general language assistant as a laboratory for alignment. arXiv preprint arXiv:2112.00861, 2021.

Yuntao Bai, Andy Jones, Kamal Ndousse, Amanda Askell, Anna Chen, Nova DasSarma, Dawn Drain, Stanislav Fort, Deep Ganguli, Tom Henighan, et al. Training a helpful and harmless assistant with reinforcement learning from human feedback. arXiv preprint arXiv:2204.05862, 2022a.

Yuntao Bai, Saurav Kadavath, Sandipan Kundu, Amanda Askell, Jackson Kernion, Andy Jones, Anna Chen, Anna Goldie, Azalia Mirhoseini, Cameron McKinnon, et al. Constitutional ai: Harmlessness from ai feedback. arXiv preprint arXiv:2212.08073, 2022b.

Dimitri P Bertsekas. Nonlinear programming. Journal of the Operational Research Society, 48(3): $334-334,1997$.

Ralph Allan Bradley and Milton E Terry. Rank analysis of incomplete block designs: I. the method of paired comparisons. Biometrika, 39(3/4):324-345, 1952.

Tom Brown, Benjamin Mann, Nick Ryder, Melanie Subbiah, Jared D Kaplan, Prafulla Dhariwal, Arvind Neelakantan, Pranav Shyam, Girish Sastry, Amanda Askell, et al. Language models are few-shot learners. Advances in neural information processing systems, 33:1877-1901, 2020.

Stephen Casper, Xander Davies, Claudia Shi, Thomas Krendl Gilbert, Jérémy Scheurer, Javier Rando, Rachel Freedman, Tomasz Korbak, David Lindner, Pedro Freire, et al. Open problems and fundamental limitations of reinforcement learning from human feedback. arXiv preprint arXiv:2307.15217, 2023 .

Mark Chen, Jerry Tworek, Heewoo Jun, Qiming Yuan, Henrique Ponde de Oliveira Pinto, Jared Kaplan, Harri Edwards, Yuri Burda, Nicholas Joseph, Greg Brockman, et al. Evaluating large language models trained on code. arXiv preprint arXiv:2107.03374, 2021.

Cheng-Han Chiang and Hung-yi Lee. Can large language models be an alternative to human evaluations? arXiv preprint arXiv:2305.01937, 2023.

Yinlam Chow, Mohammad Ghavamzadeh, Lucas Janson, and Marco Pavone. Risk-constrained reinforcement learning with percentile risk criteria. The Journal of Machine Learning Research, 18 (1):6070-6120, 2017.

Jon Christian. Amazing "jailbreak" bypasses chatgpt's ethics safeguards. Futurism, February, 4: 2023,2023 .

Paul F Christiano, Jan Leike, Tom Brown, Miljan Martic, Shane Legg, and Dario Amodei. Deep reinforcement learning from human preferences. Advances in neural information processing systems, 30, 2017.

Hyung Won Chung, Le Hou, Shayne Longpre, Barret Zoph, Yi Tay, William Fedus, Eric Li, Xuezhi Wang, Mostafa Dehghani, Siddhartha Brahma, et al. Scaling instruction-finetuned language models. arXiv preprint arXiv:2210.11416, 2022.

Ameet Deshpande, Vishvak Murahari, Tanmay Rajpurohit, Ashwin Kalyan, and Karthik Narasimhan. Toxicity in chatgpt: Analyzing persona-assigned language models. arXiv preprint arXiv:2304.05335, 2023.

Deep Ganguli, Liane Lovitt, Jackson Kernion, Amanda Askell, Yuntao Bai, Saurav Kadavath, Ben Mann, Ethan Perez, Nicholas Schiefer, Kamal Ndousse, et al. Red teaming language models to reduce harms: Methods, scaling behaviors, and lessons learned. arXiv preprint arXiv:2209.07858, 2022

Luyu Gao, Aman Madaan, Shuyan Zhou, Uri Alon, Pengfei Liu, Yiming Yang, Jamie Callan, and Graham Neubig. Pal: Program-aided language models. In International Conference on Machine Learning, pp. 10764-10799. PMLR, 2023.

Samuel Gehman, Suchin Gururangan, Maarten Sap, Yejin Choi, and Noah A Smith. Realtoxicityprompts: Evaluating neural toxic degeneration in language models. arXiv preprint arXiv:2009.11462, 2020.

Amelia Glaese, Nat McAleese, Maja Trebacz, John Aslanides, Vlad Firoiu, Timo Ewalds, Maribeth Rauh, Laura Weidinger, Martin Chadwick, Phoebe Thacker, et al. Improving alignment of dialogue agents via targeted human judgements. arXiv preprint arXiv:2209.14375, 2022.

Jiaming Ji, Mickel Liu, Juntao Dai, Xuehai Pan, Chi Zhang, Ce Bian, Ruiyang Sun, Yizhou Wang, and Yaodong Yang. Beavertails: Towards improved safety alignment of llm via a humanpreference dataset. arXiv preprint arXiv:2307.04657, 2023.

Enkelejda Kasneci, Kathrin Seßler, Stefan Küchemann, Maria Bannert, Daryna Dementieva, Frank Fischer, Urs Gasser, Georg Groh, Stephan Günnemann, Eyke Hüllermeier, et al. Chatgpt for good? on opportunities and challenges of large language models for education. Learning and individual differences, 103:102274, 2023.

Daniel Martin Katz, Michael James Bommarito, Shang Gao, and Pablo Arredondo. Gpt-4 passes the bar exam. Available at SSRN 4389233, 2023.

Changyeon Kim, Jongjin Park, Jinwoo Shin, Honglak Lee, Pieter Abbeel, and Kimin Lee. Preference transformer: Modeling human preferences using transformers for rl. arXiv preprint arXiv:2303.00957, 2023.

Jan Kocoń, Igor Cichecki, Oliwier Kaszyca, Mateusz Kochanek, Dominika Szydło, Joanna Baran, Julita Bielaniewicz, Marcin Gruza, Arkadiusz Janz, Kamil Kanclerz, et al. Chatgpt: Jack of all trades, master of none. Information Fusion, pp. 101861, 2023.

Huan Yee Koh, Jiaxin Ju, Ming Liu, and Shirui Pan. An empirical survey on long document summarization: Datasets, models, and metrics. ACM computing surveys, 55(8):1-35, 2022.

Tiffany H Kung, Morgan Cheatham, Arielle Medenilla, Czarina Sillos, Lorie De Leon, Camille Elepaño, Maria Madriaga, Rimel Aggabao, Giezel Diaz-Candido, James Maningo, et al. Performance of chatgpt on usmle: Potential for ai-assisted medical education using large language models. PLoS digital health, 2(2):e0000198, 2023.

Michael Moor, Oishi Banerjee, Zahra Shakeri Hossein Abad, Harlan M Krumholz, Jure Leskovec, Eric J Topol, and Pranav Rajpurkar. Foundation models for generalist medical artificial intelligence. Nature, 616(7956):259-265, 2023.

Andrew Y Ng, Daishi Harada, and Stuart Russell. Policy invariance under reward transformations: Theory and application to reward shaping. In Icml, volume 99, pp. 278-287. Citeseer, 1999.

OpenAI. Gpt-4 technical report, 2023.

Long Ouyang, Jeffrey Wu, Xu Jiang, Diogo Almeida, Carroll Wainwright, Pamela Mishkin, Chong Zhang, Sandhini Agarwal, Katarina Slama, Alex Ray, et al. Training language models to follow instructions with human feedback. Advances in Neural Information Processing Systems, 35: 27730-27744, 2022.

Martin L Puterman. Markov decision processes: discrete stochastic dynamic programming. John Wiley \& Sons, 2014.

Rafael Rafailov, Archit Sharma, Eric Mitchell, Stefano Ermon, Christopher D Manning, and Chelsea Finn. Direct preference optimization: Your language model is secretly a reward model. arXiv preprint arXiv:2305.18290, 2023.

Colin Raffel, Noam Shazeer, Adam Roberts, Katherine Lee, Sharan Narang, Michael Matena, Yanqi Zhou, Wei Li, and Peter J Liu. Exploring the limits of transfer learning with a unified text-to-text transformer. The Journal of Machine Learning Research, 21(1):5485-5551, 2020.

Maribeth Rauh, John Mellor, Jonathan Uesato, Po-Sen Huang, Johannes Welbl, Laura Weidinger, Sumanth Dathathri, Amelia Glaese, Geoffrey Irving, Iason Gabriel, et al. Characteristics of harmful text: Towards rigorous benchmarking of language models. Advances in Neural Information Processing Systems, 35:24720-24739, 2022.

Dorsa Sadigh, Anca D Dragan, Shankar Sastry, and Sanjit A Seshia. Active preference-based learning of reward functions. 2017.

Victor Sanh, Albert Webson, Colin Raffel, Stephen H Bach, Lintang Sutawika, Zaid Alyafeai, Antoine Chaffin, Arnaud Stiegler, Teven Le Scao, Arun Raja, et al. Multitask prompted training enables zero-shot task generalization. arXiv preprint arXiv:2110.08207, 2021.

Teven Le Scao, Angela Fan, Christopher Akiki, Ellie Pavlick, Suzana Ilić, Daniel Hesslow, Roman Castagné, Alexandra Sasha Luccioni, François Yvon, Matthias Gallé, et al. Bloom: A 176bparameter open-access multilingual language model. arXiv preprint arXiv:2211.05100, 2022.

John Schulman, Filip Wolski, Prafulla Dhariwal, Alec Radford, and Oleg Klimov. Proximal policy optimization algorithms. arXiv preprint arXiv:1707.06347, 2017.

John Schulman, Philipp Moritz, Sergey Levine, Michael Jordan, and Pieter Abbeel. Highdimensional continuous control using generalized advantage estimation. arXiv preprint arXiv:1506.02438, 2018.

Emily Sheng, Kai-Wei Chang, Premkumar Natarajan, and Nanyun Peng. Societal biases in language generation: Progress and challenges. arXiv preprint arXiv:2105.04054, 2021.

Toby Shevlane, Sebastian Farquhar, Ben Garfinkel, Mary Phuong, Jess Whittlestone, Jade Leung, Daniel Kokotajlo, Nahema Marchal, Markus Anderljung, Noam Kolt, et al. Model evaluation for extreme risks. arXiv preprint arXiv:2305.15324, 2023.

Feifan Song, Bowen Yu, Minghao Li, Haiyang Yu, Fei Huang, Yongbin Li, and Houfeng Wang. Preference ranking optimization for human alignment. arXiv preprint arXiv:2306.17492, 2023.

Nisan Stiennon, Long Ouyang, Jeffrey Wu, Daniel Ziegler, Ryan Lowe, Chelsea Voss, Alec Radford, Dario Amodei, and Paul F Christiano. Learning to summarize with human feedback. Advances in Neural Information Processing Systems, 33:3008-3021, 2020.

Hao Sun, Zhexin Zhang, Jiawen Deng, Jiale Cheng, and Minlie Huang. Safety assessment of chinese large language models, 2023a.

Zhiqing Sun, Yikang Shen, Qinhong Zhou, Hongxin Zhang, Zhenfang Chen, David Cox, Yiming Yang, and Chuang Gan. Principle-driven self-alignment of language models from scratch with minimal human supervision. arXiv preprint arXiv:2305.03047, 2023b.

Rohan Taori, Ishaan Gulrajani, Tianyi Zhang, Yann Dubois, Xuechen Li, Carlos Guestrin, Percy Liang, and Tatsunori B Hashimoto. Stanford alpaca: An instruction-following llama model, 2023.

Hugo Touvron, Thibaut Lavril, Gautier Izacard, Xavier Martinet, Marie-Anne Lachaux, Timothée Lacroix, Baptiste Rozière, Naman Goyal, Eric Hambro, Faisal Azhar, Aurelien Rodriguez, Armand Joulin, Edouard Grave, and Guillaume Lample. Llama: Open and efficient foundation language models. arXiv preprint arXiv:2302.13971, 2023a.

Hugo Touvron, Louis Martin, Kevin Stone, Peter Albert, Amjad Almahairi, Yasmine Babaei, Nikolay Bashlykov, Soumya Batra, Prajjwal Bhargava, Shruti Bhosale, et al. Llama 2: Open foundation and fine-tuned chat models. arXiv preprint arXiv:2307.09288, 2023b.

Laura Weidinger, John Mellor, Maribeth Rauh, Conor Griffin, Jonathan Uesato, Po-Sen Huang, Myra Cheng, Mia Glaese, Borja Balle, Atoosa Kasirzadeh, et al. Ethical and social risks of harm from language models. arXiv preprint arXiv:2112.04359, 2021.

Laura Weidinger, Jonathan Uesato, Maribeth Rauh, Conor Griffin, Po-Sen Huang, John Mellor, Amelia Glaese, Myra Cheng, Borja Balle, Atoosa Kasirzadeh, et al. Taxonomy of risks posed by language models. In Proceedings of the 2022 ACM Conference on Fairness, Accountability, and Transparency, pp. 214-229, 2022.

Zeqiu Wu, Yushi Hu, Weijia Shi, Nouha Dziri, Alane Suhr, Prithviraj Ammanabrolu, Noah A Smith, Mari Ostendorf, and Hannaneh Hajishirzi. Fine-grained human feedback gives better rewards for language model training. arXiv preprint arXiv:2306.01693, 2023.

Kevin Yang, Dan Klein, Asli Celikyilmaz, Nanyun Peng, and Yuandong Tian. Rlcd: Reinforcement learning from contrast distillation for language model alignment. arXiv preprint arXiv:2307.12950, 2023

Xi Yang, Aokun Chen, Nima PourNejatian, Hoo Chang Shin, Kaleb E Smith, Christopher Parisien, Colin Compas, Cheryl Martin, Anthony B Costa, Mona G Flores, et al. A large language model for electronic health records. NPJ Digital Medicine, 5(1):194, 2022.

Zheng Yuan, Hongyi Yuan, Chuanqi Tan, Wei Wang, Songfang Huang, and Fei Huang. Rrhf: Rank responses to align language models with human feedback without tears. arXiv preprint arXiv:2304.05302, 2023.
